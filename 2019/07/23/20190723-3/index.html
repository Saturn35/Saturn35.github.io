<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  

  
    
      
    

    
  

  
    
    
    <link href="https://fonts.cat.net/css?family=Lato:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Roboto Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.jpg?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.jpg?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.jpg?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="Part1  Buffer Overflows &amp;#x6C60;&amp;#x662F;&amp;#x5185;&amp;#x6838;&amp;#x6A21;&amp;#x5F0F;&amp;#x5185;&amp;#x5B58;&amp;#xFF0C;&amp;#x7528;&amp;#x4F5C;&amp;#x9A71;&amp;#x52A8;&amp;#x7A0B;&amp;#x5E8F;&amp;#x7684;&amp;#x5B58;&amp;#x50A8;&amp;#x7A7A;&amp;#x95F4;&amp;#x3002; &amp;#x6C60">
<meta property="og:type" content="article">
<meta property="og:title" content="[翻译]内核池基础知识（池损坏）">
<meta property="og:url" content="https://saturn35.github.io/2019/07/23/20190723-3/index.html">
<meta property="og:site_name" content="Saturn35">
<meta property="og:description" content="Part1  Buffer Overflows &amp;#x6C60;&amp;#x662F;&amp;#x5185;&amp;#x6838;&amp;#x6A21;&amp;#x5F0F;&amp;#x5185;&amp;#x5B58;&amp;#xFF0C;&amp;#x7528;&amp;#x4F5C;&amp;#x9A71;&amp;#x52A8;&amp;#x7A0B;&amp;#x5E8F;&amp;#x7684;&amp;#x5B58;&amp;#x50A8;&amp;#x7A7A;&amp;#x95F4;&amp;#x3002; &amp;#x6C60">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://saturn35.github.io/2019/07/23/20190723-3/1.png">
<meta property="og:image" content="https://saturn35.github.io/2019/07/23/20190723-3/2.png">
<meta property="og:image" content="https://saturn35.github.io/2019/07/23/20190723-3/3.png">
<meta property="og:image" content="https://saturn35.github.io/2019/07/23/20190723-3/4.png">
<meta property="og:image" content="https://saturn35.github.io/2019/07/23/20190723-3/5.png">
<meta property="og:updated_time" content="2019-12-28T05:22:06.428Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="[翻译]内核池基础知识（池损坏）">
<meta name="twitter:description" content="Part1  Buffer Overflows &amp;#x6C60;&amp;#x662F;&amp;#x5185;&amp;#x6838;&amp;#x6A21;&amp;#x5F0F;&amp;#x5185;&amp;#x5B58;&amp;#xFF0C;&amp;#x7528;&amp;#x4F5C;&amp;#x9A71;&amp;#x52A8;&amp;#x7A0B;&amp;#x5E8F;&amp;#x7684;&amp;#x5B58;&amp;#x50A8;&amp;#x7A7A;&amp;#x95F4;&amp;#x3002; &amp;#x6C60">
<meta name="twitter:image" content="https://saturn35.github.io/2019/07/23/20190723-3/1.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://saturn35.github.io/2019/07/23/20190723-3/">






  <title>[翻译]内核池基础知识（池损坏） | Saturn35</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Saturn35</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>




 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://saturn35.github.io/2019/07/23/20190723-3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Saturn35">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/head.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Saturn35">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">[翻译]内核池基础知识（池损坏）</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-23T16:23:01+08:00">
                2019-07-23
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/07/23/20190723-3/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2019/07/23/20190723-3/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  5,080
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  22
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h4 id="Part1-Buffer-Overflows"><a href="#Part1-Buffer-Overflows" class="headerlink" title="Part1  Buffer Overflows"></a><strong>Part1  Buffer Overflows</strong></h4><p> &#x6C60;&#x662F;&#x5185;&#x6838;&#x6A21;&#x5F0F;&#x5185;&#x5B58;&#xFF0C;&#x7528;&#x4F5C;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x7684;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;&#x3002;</p>
<p>&#x6C60;&#x7684;&#x7EC4;&#x7EC7;&#x65B9;&#x5F0F;&#x4E0E;&#x5728;&#x4ECE;&#x6F14;&#x8BB2;&#x6216;&#x4E66;&#x4E2D;&#x8BB0;&#x7B14;&#x8BB0;&#x65F6;&#x4F7F;&#x7528;&#x8BB0;&#x4E8B;&#x672C;&#x7684;&#x65B9;&#x5F0F;&#x7C7B;&#x4F3C;&#x3002; &#x6709;&#x4E9B;&#x7B14;&#x8BB0;&#x53EF;&#x80FD;&#x662F;1&#x884C;&#xFF0C;&#x5176;&#x4ED6;&#x7B14;&#x8BB0;&#x53EF;&#x80FD;&#x662F;&#x591A;&#x884C;&#x3002; &#x8BB8;&#x591A;&#x4E0D;&#x540C;&#x7684;&#x6CE8;&#x91CA;&#x90FD;&#x5728;&#x540C;&#x4E00;&#x9875;&#x9762;&#x4E0A;&#x3002;&#x5185;&#x5B58;&#x4E5F;&#x88AB;&#x7EC4;&#x7EC7;&#x6210;&#x9875;&#xFF0C;&#x901A;&#x5E38;&#x4E00;&#x9875;&#x5185;&#x5B58;&#x4E3A;4KB&#x3002; Windows&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x5668;&#x5C06;&#x8FD9;&#x4E2A;4KB&#x7684;&#x9875;&#x9762;&#x5206;&#x6210;&#x66F4;&#x5C0F;&#x7684;&#x5757;&#x3002; &#x4E00;&#x4E2A;&#x5757;&#x53EF;&#x80FD;&#x5C0F;&#x5230;8&#x4E2A;&#x5B57;&#x8282;&#x6216;&#x53EF;&#x80FD;&#x66F4;&#x5927;&#x3002; &#x8FD9;&#x4E9B;&#x5757;&#x4E2D;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#x4E0E;&#x5176;&#x4ED6;&#x5757;&#x5E76;&#x6392;&#x5B58;&#x5728;&#x3002;</p>
<p>&#xFF01;pool&#x547D;&#x4EE4;&#x53EF;&#x7528;&#x4E8E;&#x67E5;&#x770B;&#x5B58;&#x50A8;&#x5728;&#x9875;&#x9762;&#x4E2D;&#x7684;&#x6C60;&#x5757;&#x3002;</p>
<figure class="highlight irpf90"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">kd&gt; <span class="comment">!pool fffffa8003f42000</span></span><br><span class="line">Pool page fffffa8003f42000 region is Nonpaged pool</span><br><span class="line">*fffffa8003f42000 <span class="built_in">size</span>:  <span class="number">410</span> previous <span class="built_in">size</span>:    <span class="number">0</span>  (<span class="keyword">Free</span>)      *Irp</span><br><span class="line">            Pooltag Irp  : Io, IRP packets</span><br><span class="line">fffffa8003f42410 <span class="built_in">size</span>:   <span class="number">40</span> previous <span class="built_in">size</span>:  <span class="number">410</span>  (<span class="built_in">Allocated</span>)  MmSe</span><br><span class="line">fffffa8003f42450 <span class="built_in">size</span>:  <span class="number">150</span> previous <span class="built_in">size</span>:   <span class="number">40</span>  (<span class="built_in">Allocated</span>)  <span class="keyword">File</span></span><br><span class="line">fffffa8003f425a0 <span class="built_in">size</span>:   <span class="number">80</span> previous <span class="built_in">size</span>:  <span class="number">150</span>  (<span class="built_in">Allocated</span>)  Even</span><br><span class="line">fffffa8003f42620 <span class="built_in">size</span>:   c0 previous <span class="built_in">size</span>:   <span class="number">80</span>  (<span class="built_in">Allocated</span>)  EtwR</span><br><span class="line">fffffa8003f426e0 <span class="built_in">size</span>:   d0 previous <span class="built_in">size</span>:   c0  (<span class="built_in">Allocated</span>)  CcBc</span><br><span class="line">fffffa8003f427b0 <span class="built_in">size</span>:   d0 previous <span class="built_in">size</span>:   d0  (<span class="built_in">Allocated</span>)  CcBc</span><br><span class="line">fffffa8003f42880 <span class="built_in">size</span>:   <span class="number">20</span> previous <span class="built_in">size</span>:   d0  (<span class="keyword">Free</span>)       <span class="keyword">Free</span></span><br><span class="line">fffffa8003f428a0 <span class="built_in">size</span>:   d0 previous <span class="built_in">size</span>:   <span class="number">20</span>  (<span class="built_in">Allocated</span>)  <span class="keyword">Wait</span></span><br><span class="line">fffffa8003f42970 <span class="built_in">size</span>:   <span class="number">80</span> previous <span class="built_in">size</span>:   d0  (<span class="built_in">Allocated</span>)  CM44</span><br><span class="line">fffffa8003f429f0 <span class="built_in">size</span>:   <span class="number">80</span> previous <span class="built_in">size</span>:   <span class="number">80</span>  (<span class="built_in">Allocated</span>)  Even</span><br><span class="line">fffffa8003f42a70 <span class="built_in">size</span>:   <span class="number">80</span> previous <span class="built_in">size</span>:   <span class="number">80</span>  (<span class="built_in">Allocated</span>)  Even</span><br><span class="line">fffffa8003f42af0 <span class="built_in">size</span>:   d0 previous <span class="built_in">size</span>:   <span class="number">80</span>  (<span class="built_in">Allocated</span>)  <span class="keyword">Wait</span></span><br><span class="line">fffffa8003f42bc0 <span class="built_in">size</span>:   <span class="number">80</span> previous <span class="built_in">size</span>:   d0  (<span class="built_in">Allocated</span>)  CM44</span><br><span class="line">fffffa8003f42c40 <span class="built_in">size</span>:   d0 previous <span class="built_in">size</span>:   <span class="number">80</span>  (<span class="built_in">Allocated</span>)  <span class="keyword">Wait</span></span><br><span class="line">fffffa8003f42d10 <span class="built_in">size</span>:  <span class="number">230</span> previous <span class="built_in">size</span>:   d0  (<span class="built_in">Allocated</span>)  ALPC</span><br><span class="line">fffffa8003f42f40 <span class="built_in">size</span>:   c0 previous <span class="built_in">size</span>:  <span class="number">230</span>  (<span class="built_in">Allocated</span>)  EtwR</span><br></pre></td></tr></table></figure>

<p>&#x7531;&#x4E8E;&#x8BB8;&#x591A;&#x6C60;&#x5206;&#x914D;&#x5B58;&#x50A8;&#x5728;&#x540C;&#x4E00;&#x9875;&#x9762;&#x4E2D;&#xFF0C;&#x56E0;&#x6B64;&#x6BCF;&#x4E2A;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x4EC5;&#x4F7F;&#x7528;&#x5DF2;&#x5206;&#x914D;&#x7684;&#x7A7A;&#x95F4;&#x81F3;&#x5173;&#x91CD;&#x8981;&#x3002;&#x5982;&#x679C;DriverA&#x4F7F;&#x7528;&#x7684;&#x7A7A;&#x95F4;&#x6BD4;&#x5206;&#x914D;&#x7684;&#x7A7A;&#x95F4;&#x591A;&#xFF0C;&#x5219;&#x4F1A;&#x5199;&#x5165;&#x4E0B;&#x4E00;&#x4E2A;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x7684;&#x7A7A;&#x95F4;&#xFF08;DriverB&#xFF09;&#x5E76;&#x635F;&#x574F;DriverB&#x7684;&#x6570;&#x636E;&#x3002;&#x5C06;&#x8FD9;&#x79CD;&#x8986;&#x76D6;&#x5230;&#x4E0B;&#x4E00;&#x4E2A;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x7684;&#x7A7A;&#x95F4;&#x7684;&#x60C5;&#x51B5;&#x79F0;&#x4E3A;&#x7F13;&#x51B2;&#x533A;&#x6EA2;&#x51FA;&#x3002;&#x63A5;&#x7740;&#xFF0C;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x5668;&#x6216;DriverB&#x5C06;&#x5C1D;&#x8BD5;&#x4F7F;&#x7528;&#x6B64;&#x635F;&#x574F;&#x7684;&#x5185;&#x5B58;&#xFF0C;&#x5E76;&#x5C06;&#x9047;&#x5230;&#x610F;&#x5916;&#x7684;&#x4FE1;&#x606F;&#x3002;&#x8FD9;&#x79CD;&#x610F;&#x5916;&#x4FE1;&#x606F;&#x901A;&#x5E38;&#x4F1A;&#x5BFC;&#x81F4;&#x84DD;&#x5C4F;&#xFF08;BSOD&#xFF09;&#x3002;</p>
<p><img src="/2019/07/23/20190723-3/1.png" alt="img"></p>
<p>&#x901A;&#x5E38;&#xFF0C;&#x6C60;&#x635F;&#x574F;&#x663E;&#x793A;&#x4E3A;&#x7EC8;&#x6B62;&#x7801; 0x19 BAD_POOL_HEADER&#x6216;&#x7EC8;&#x6B62;&#x7801; 0xC2 BAD_POOL_CALLER&#x3002; &#x8FD9;&#x4E9B;&#x7EC8;&#x6B62;&#x7801;&#x53EF;&#x4EE5;&#x8F7B;&#x677E;&#x786E;&#x5B9A;&#x5D29;&#x6E83;&#x4E2D;&#x6D89;&#x53CA;&#x6C60;&#x635F;&#x574F;&#x3002; &#x4F46;&#x662F;&#xFF0C;&#x8BBF;&#x95EE;&#x610F;&#x5916;&#x5185;&#x5B58;&#x7684;&#x7ED3;&#x679C;&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x5F88;&#x5927;&#x5DEE;&#x5F02;&#xFF0C;&#x56E0;&#x6B64;&#x6C60;&#x635F;&#x574F;&#x4F1A;&#x5BFC;&#x81F4;&#x8BB8;&#x591A;&#x4E0D;&#x540C;&#x7C7B;&#x578B;&#x7684;&#x9519;&#x8BEF;&#x68C0;&#x67E5;&#x3002;</p>
<p>&#x4E0E;&#x4EFB;&#x4F55;&#x84DD;&#x5C4F;&#x8F6C;&#x50A8;&#x5206;&#x6790;&#x4E00;&#x6837;&#xFF0C;&#x6700;&#x597D;&#x7684;&#x8D77;&#x70B9;&#x662F;&#xFF01;analyze -v&#x3002; &#x6B64;&#x547D;&#x4EE4;&#x5C06;&#x663E;&#x793A;&#x7EC8;&#x6B62;&#x7801;&#x548C;&#x53C2;&#x6570;&#xFF0C;&#x5E76;&#x5BF9;&#x5D29;&#x6E83;&#x8FDB;&#x884C;&#x4E00;&#x4E9B;&#x57FA;&#x672C;&#x89E3;&#x91CA;&#x3002;</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">kd&gt; !analyze -v</span><br><span class="line"><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="emphasis">***</span>*</span><br><span class="line"><span class="bullet">*                                                                             </span>*</span><br><span class="line"><span class="bullet">*                        </span>Bugcheck Analysis                                    *</span><br><span class="line"><span class="bullet">*                                                                             </span>*</span><br><span class="line"><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="emphasis">***</span>*</span><br><span class="line">SYSTEM<span class="emphasis">_SERVICE_</span>EXCEPTION (3b)</span><br><span class="line">An exception happened while executing a system service routine.</span><br><span class="line">Arguments:</span><br><span class="line">Arg1: 00000000c0000005, Exception code that caused the bugcheck</span><br><span class="line">Arg2: fffff8009267244a, Address of the instruction which caused the bugcheck</span><br><span class="line">Arg3: fffff88004763560, Address of the context record for the exception that caused the bugcheck</span><br><span class="line">Arg4: 0000000000000000, zero.</span><br></pre></td></tr></table></figure>



<p>&#x5728;&#x4E0A;&#x8FF0;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x9519;&#x8BEF;&#x68C0;&#x67E5;&#x662F;&#x4E00;&#x4E2A;&#x7EC8;&#x6B62;&#x7801; 0x3B SYSTEM_SERVICE_EXCEPTION&#x3002; &#x6B64;&#x7EC8;&#x6B62;&#x7801;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x662F;c0000005&#xFF0C;&#x5B83;&#x662F;&#x8BBF;&#x95EE;&#x51B2;&#x7A81;&#x7684;&#x72B6;&#x6001;&#x4EE3;&#x7801;&#x3002; &#x8BBF;&#x95EE;&#x51B2;&#x7A81;&#x662F;&#x5C1D;&#x8BD5;&#x8BBF;&#x95EE;&#x65E0;&#x6548;&#x5185;&#x5B58;&#xFF08;&#x6B64;&#x9519;&#x8BEF;&#x4E0E;&#x6743;&#x9650;&#x65E0;&#x5173;&#xFF09;&#x3002; &#x53EF;&#x4EE5;&#x5728;WDK&#x5934;ntstatus.h&#x4E2D;&#x67E5;&#x627E;&#x72B6;&#x6001;&#x4EE3;&#x7801;&#x3002;</p>
<p>&#xFF01;analyze -v&#x547D;&#x4EE4;&#x8FD8;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x6709;&#x7528;&#x7684;&#x6377;&#x5F84;&#x6765;&#x8FDB;&#x5165;&#x5931;&#x8D25;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x3002;</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CONTEXT:  fffff<span class="number">88004763560</span> -- (.cxr <span class="number">0</span>xfffff<span class="number">88004763560</span><span class="comment">;r)</span></span><br></pre></td></tr></table></figure>



<p>&#x8FD0;&#x884C;&#x6B64;&#x547D;&#x4EE4;&#x4F1A;&#x5411;&#x6211;&#x4EEC;&#x663E;&#x793A;&#x5D29;&#x6E83;&#x65F6;&#x7684;&#x5BC4;&#x5B58;&#x5668;&#x503C;&#x3002;</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">kd&gt; .cxr 0xfffff88004763560</span><br><span class="line"><span class="attribute">rax</span>=4f4f4f4f4f4f4f4f <span class="attribute">rbx</span>=fffff80092690460 <span class="attribute">rcx</span>=fffff800926fbc60</span><br><span class="line"><span class="attribute">rdx</span>=0000000000000000 <span class="attribute">rsi</span>=0000000000001000 <span class="attribute">rdi</span>=0000000000000000</span><br><span class="line"><span class="attribute">rip</span>=fffff8009267244a <span class="attribute">rsp</span>=fffff88004763f60 <span class="attribute">rbp</span>=fffff8009268fb40</span><br><span class="line"><span class="attribute">r8</span>=fffffa8001a1b820  <span class="attribute">r9</span>=0000000000000001 <span class="attribute">r10</span>=fffff800926fbc60</span><br><span class="line"><span class="attribute">r11</span>=0000000000000011 <span class="attribute">r12</span>=0000000000000000 <span class="attribute">r13</span>=fffff8009268fb48</span><br><span class="line"><span class="attribute">r14</span>=0000000000000012 <span class="attribute">r15</span>=000000006374504d</span><br><span class="line"><span class="attribute">iopl</span>=0         nv up ei pl nz na po nc</span><br><span class="line"><span class="attribute">cs</span>=0010  <span class="attribute">ss</span>=0018  <span class="attribute">ds</span>=002b  <span class="attribute">es</span>=002b  <span class="attribute">fs</span>=0053  <span class="attribute">gs</span>=002b             <span class="attribute">efl</span>=00010206</span><br><span class="line">nt!ExAllocatePoolWithTag+0x442:</span><br><span class="line">fffff800`9267244a 4c8b4808        mov     r9,qword ptr [rax+8] ds:002b:4f4f4f4f`<span class="attribute">4f4f4f57</span>=????????????????</span><br></pre></td></tr></table></figure>



<p>&#x4ECE;&#x4E0A;&#x9762;&#x7684;&#x8F93;&#x51FA;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5D29;&#x6E83;&#x53D1;&#x751F;&#x5728;ExAllocatePoolWithTag&#x4E2D;&#xFF0C;&#x8FD9;&#x5F88;&#x597D;&#x5730;&#x8868;&#x660E;&#x5D29;&#x6E83;&#x662F;&#x7531;&#x4E8E;&#x6C60;&#x635F;&#x574F;&#x9020;&#x6210;&#x7684;&#x3002; &#x901A;&#x5E38;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x770B;&#x7740;dump&#x7684;&#x5DE5;&#x7A0B;&#x5E08;&#x4F1A;&#x5728;&#x6B64;&#x65F6;&#x505C;&#x6B62;&#x5E76;&#x5F97;&#x51FA;&#x7ED3;&#x8BBA;&#x8BA4;&#x4E3A;&#x5D29;&#x6E83;&#x662F;&#x7531;&#x6C60;&#x635F;&#x574F;&#x5F15;&#x8D77;&#x7684;&#xFF0C;&#x4F46;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x66F4;&#x8FDB;&#x4E00;&#x6B65;&#x3002;</p>
<p>&#x6267;&#x884C;&#x5931;&#x8D25;&#x7684;&#x6307;&#x4EE4;&#x662F;&#x89E3;&#x5F15;&#x7528;rax + 8&#x3002; rax&#x5BC4;&#x5B58;&#x5668;&#x5305;&#x542B;4f4f4f4f4f4f4f4f&#xFF0C;&#x5B83;&#x4E0D;&#x5177;&#x6709;x64&#x7CFB;&#x7EDF;&#x4E0A;&#x6307;&#x9488;&#x6240;&#x9700;&#x7684;&#x89C4;&#x8303;&#x5F62;&#x5F0F;&#x3002; &#x8FD9;&#x8BF4;&#x660E;&#x56E0;&#x4E3A;rax&#x4E2D;&#x7684;&#x6570;&#x636E;&#x5E94;&#x8BE5;&#x662F;&#x4E00;&#x4E2A;&#x6307;&#x9488;&#xFF0C;&#x4F46;&#x5F88;&#x660E;&#x663E;&#x4ED6;&#x4E0D;&#x662F;&#xFF0C;&#x5BFC;&#x81F4;&#x7CFB;&#x7EDF;&#x5D29;&#x6E83;&#x4E86;&#x3002;</p>
<p>&#x8981;&#x786E;&#x5B9A;rax&#x4E0D;&#x5305;&#x542B;&#x9884;&#x671F;&#x6570;&#x636E;&#x7684;&#x539F;&#x56E0;&#xFF0C;&#x6211;&#x4EEC;&#x5FC5;&#x987B;&#x5728;&#x5931;&#x8D25;&#x4E4B;&#x524D;&#x68C0;&#x67E5;&#x6307;&#x4EE4;&#x3002;</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">kd&gt; ub .</span><br><span class="line">nt!KzAcquireQueuedSpinLock [inlined <span class="keyword">in</span> nt!ExAllocatePoolWithTag+<span class="number">0x421</span>]:</span><br><span class="line">fffff800<span class="string">`92672429 488d542440      lea     rdx,[rsp+40h]</span></span><br><span class="line"><span class="string">fffff800`</span>9267242e <span class="number">49875500</span>        <span class="keyword">xchg</span>    <span class="built_in">rdx</span>,<span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="built_in">r13</span>]</span><br><span class="line">fffff800<span class="string">`92672432 4885d2          test    rdx,rdx</span></span><br><span class="line"><span class="string">fffff800`</span><span class="number">92672435</span> 0f85c3030000    <span class="keyword">jne</span>     nt!ExAllocatePoolWithTag+<span class="number">0x7ec</span> (fffff800<span class="string">`926727fe)</span></span><br><span class="line"><span class="string">fffff800`</span>9267243b 48391b          <span class="keyword">cmp</span>     <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="built_in">rbx</span>],<span class="built_in">rbx</span></span><br><span class="line">fffff800<span class="string">`9267243e 0f8464060000    je      nt!ExAllocatePoolWithTag+0xa94 (fffff800`</span>92672aa8)</span><br><span class="line">fffff800<span class="string">`92672444 4c8b03          mov     r8,qword ptr [rbx]</span></span><br><span class="line"><span class="string">fffff800`</span><span class="number">92672447</span> 498b00          <span class="keyword">mov</span>     <span class="built_in">rax</span>,<span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="built_in">r8</span>]</span><br></pre></td></tr></table></figure>



<p>&#x6C47;&#x7F16;&#x4EE3;&#x7801;&#x4E2D;&#x663E;&#x793A;rax&#x6765;&#x81EA;r8&#x6240;&#x6307;&#x5411;&#x6570;&#x636E;&#x3002;&#x67E5;&#x627E;&#x524D;&#x9762;&#x5BC4;&#x5B58;&#x5668;&#x7684;&#x503C;&#xFF0C;&#x770B;&#x5230;r8&#x503C;&#x4E3A;fffffa8001a1b820&#xFF0C;&#x67E5;&#x770B;&#x5185;&#x5B58;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x4E0E;rax&#x4E2D;&#x6570;&#x636E;&#x4E00;&#x81F4;&#xFF0C;&#x7531;&#x6B64;&#x53EF;&#x4EE5;&#x65AD;&#x5B9A;&#xFF0C;&#x662F;&#x6B64;&#x5904;&#x5185;&#x5B58;&#x51FA;&#x73B0;&#x95EE;&#x9898;&#x3002;</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kd&gt; dq fffffa8001a1b820 l1</span><br><span class="line">fffffa80`<span class="number">01</span>a1b820  <span class="number">4</span>f4f4f4f`<span class="number">4</span>f4f4f4f</span><br></pre></td></tr></table></figure>



<p>&#x8981;&#x786E;&#x5B9A;&#x6B64;&#x610F;&#x5916;&#x6570;&#x636E;&#x662F;&#x5426;&#x662F;&#x7531;&#x6C60;&#x635F;&#x574F;&#x5F15;&#x8D77;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#xFF01;pool&#x547D;&#x4EE4;&#x3002;</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kd&gt; !pool fffffa8001a1b820</span><br><span class="line">Pool<span class="built_in"> page </span>fffffa8001a1b820 region is Nonpaged pool</span><br><span class="line"> fffffa8001a1b000 size:  810 previous size:    0  (Allocated)  None</span><br></pre></td></tr></table></figure>



<p>fffffa8001a1b810&#x770B;&#x8D77;&#x6765;&#x4E0D;&#x50CF;&#x662F;&#x4E00;&#x4E2A;&#x6709;&#x6548;&#x7684;&#x5C0F;&#x6C60;&#x5206;&#x914D;&#xFF0C;&#x68C0;&#x67E5;&#x6574;&#x4E2A;&#x9875;&#x9762;&#x662F;&#x5426;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x5927;&#x9875;&#x9762;&#x5206;&#x914D;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x2026;&#x2026;</p>
<figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">kd&gt; !pool fffffa8001a1b820</span><br><span class="line">Pool page fffffa8001a1b820 region <span class="keyword">is</span> Nonpaged pool</span><br><span class="line">fffffa8001a1b000 size:  <span class="number">810</span> previous size:    <span class="number">0</span>  (Allocated)  None</span><br><span class="line">fffffa8001a1b810 doesn<span class="symbol">&apos;t</span> look like a valid small pool allocation, checking <span class="keyword">to</span> see</span><br><span class="line"><span class="keyword">if</span> the entire page <span class="keyword">is</span> actually part <span class="keyword">of</span> a large page allocation...</span><br><span class="line">fffffa8001a1b810 <span class="keyword">is</span> <span class="keyword">not</span> a valid large pool allocation, checking large session pool...</span><br><span class="line">fffffa8001a1b810 <span class="keyword">is</span> freed (<span class="keyword">or</span> corrupt) pool</span><br><span class="line">Bad previous allocation size @fffffa8001a1b810, last size was <span class="number">81</span></span><br><span class="line">***</span><br><span class="line">*** An <span class="literal">error</span> (<span class="keyword">or</span> corruption) <span class="keyword">in</span> the pool was detected;</span><br><span class="line">*** Attempting <span class="keyword">to</span> diagnose the problem.</span><br><span class="line">***</span><br><span class="line">*** <span class="keyword">Use</span> !poolval fffffa8001a1b000 <span class="keyword">for</span> more details.</span><br><span class="line">Pool page [ fffffa8001a1b000 ] <span class="keyword">is</span> __inVALID.</span><br><span class="line">Analyzing linked list...</span><br><span class="line">[ fffffa8001a1b000 <span class="comment">--&gt; fffffa8001a1b010 (size = 0x10 bytes)]: Corrupt region</span></span><br><span class="line"></span><br><span class="line">Scanning <span class="keyword">for</span> single <span class="built_in">bit</span> errors...</span><br><span class="line"></span><br><span class="line">None found</span><br></pre></td></tr></table></figure>



<p>&#x4E0A;&#x9762;&#x7684;&#x8F93;&#x51FA;&#x770B;&#x8D77;&#x6765;&#x4E0D;&#x50CF;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x4F7F;&#x7528;&#x7684;&#xFF01;pool&#x547D;&#x4EE4;&#x3002; &#x6B64;&#x8F93;&#x51FA;&#x663E;&#x793A;&#x6C60;&#x6807;&#x5934;&#x7684;&#x635F;&#x574F;&#xFF0C;&#x8FD9;&#x4F1A;&#x963B;&#x6B62;&#x547D;&#x4EE4;&#x8D70;&#x5206;&#x914D;&#x94FE;&#x3002;</p>
<p>&#x4E0A;&#x9762;&#x7684;&#x8F93;&#x51FA;&#x663E;&#x793A;&#x5728;&#x5927;&#x5C0F;&#x4E3A;810&#x7684;fffffa8001a1b000&#x4E0A;&#x6709;&#x4E00;&#x5904;&#x5206;&#x914D;&#x3002;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x67E5;&#x770B;&#x8FD9;&#x4E2A;&#x5185;&#x5B58;&#xFF0C;&#x6211;&#x4EEC;&#x5E94;&#x8BE5;&#x770B;&#x5230;&#x4E00;&#x4E2A;&#x6C60;&#x5934;&#x3002; &#x4F46;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x770B;&#x5230;&#x7684;&#x662F;4f4f4f4f`4f4f4f4f&#x7684;&#x6837;&#x5B50;&#x3002;</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">kd&gt; dq fffffa8001a1b000 + <span class="number">810</span></span><br><span class="line">fffffa80`<span class="number">01</span>a1b810  <span class="number">4</span>f4f4f4f`<span class="number">4</span>f4f4f4f <span class="number">4</span>f4f4f4f`<span class="number">4</span>f4f4f4f</span><br><span class="line">fffffa80`<span class="number">01</span>a1b820  <span class="number">4</span>f4f4f4f`<span class="number">4</span>f4f4f4f <span class="number">4</span>f4f4f4f`<span class="number">4</span>f4f4f4f</span><br><span class="line">fffffa80`<span class="number">01</span>a1b830  <span class="number">4</span>f4f4f4f`<span class="number">4</span>f4f4f4f <span class="number">00574</span>f4c`<span class="number">46524556</span></span><br><span class="line">fffffa80`<span class="number">01</span>a1b840  <span class="number">00000000</span>`<span class="number">00000000</span> <span class="number">00000000</span>`<span class="number">00000000</span></span><br><span class="line">fffffa80`<span class="number">01</span>a1b850  <span class="number">00000000</span>`<span class="number">00000000</span> <span class="number">00000000</span>`<span class="number">00000000</span></span><br><span class="line">fffffa80`<span class="number">01</span>a1b860  <span class="number">00000000</span>`<span class="number">00000000</span> <span class="number">00000000</span>`<span class="number">00000000</span></span><br><span class="line">fffffa80`<span class="number">01</span>a1b870  <span class="number">00000000</span>`<span class="number">00000000</span> <span class="number">00000000</span>`<span class="number">00000000</span></span><br><span class="line">fffffa80`<span class="number">01</span>a1b880  <span class="number">00000000</span>`<span class="number">00000000</span> <span class="number">00000000</span>`<span class="number">00000000</span></span><br></pre></td></tr></table></figure>

<p>&#x6B64;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x786E;&#x5B9A;&#x7CFB;&#x7EDF;&#x56E0;&#x6C60;&#x635F;&#x574F;&#x800C;&#x5D29;&#x6E83;&#x3002;</p>
<p>&#x56E0;&#x4E3A;&#x635F;&#x574F;&#x53D1;&#x751F;&#x5728;&#x4E4B;&#x524D;&#xFF0C;&#x5E76;&#x4E14;&#x8F6C;&#x50A8;&#x662F;&#x7CFB;&#x7EDF;&#x5F53;&#x524D;&#x72B6;&#x6001;&#x7684;&#x5FEB;&#x7167;&#xFF0C;&#x6240;&#x4EE5;&#x6CA1;&#x6709;&#x5177;&#x4F53;&#x8BC1;&#x636E;&#x8868;&#x660E;&#x5185;&#x5B58;&#x662F;&#x5982;&#x4F55;&#x88AB;&#x7834;&#x574F;&#x7684;&#x3002; &#x5728;&#x635F;&#x574F;&#x4E4B;&#x524D;&#x7ACB;&#x5373;&#x5206;&#x914D;&#x6C60;&#x5757;&#x7684;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x53EF;&#x80FD;&#x662F;&#x5199;&#x5165;&#x9519;&#x8BEF;&#x4F4D;&#x7F6E;&#x5E76;&#x5BFC;&#x81F4;&#x6B64;&#x635F;&#x574F;&#x7684;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x3002; &#x6B64;&#x6C60;&#x5757;&#x6807;&#x6709;&#x201C;None&#x201D;&#x6807;&#x8BB0;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x641C;&#x7D22;&#x6B64;&#x6807;&#x8BB0;&#x4EE5;&#x786E;&#x5B9A;&#x54EA;&#x4E9B;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x4F7F;&#x7528;&#x5B83;&#x3002;</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kd&gt; !for_each_module s -<span class="selector-tag">a</span> @<span class="selector-id">#Base</span> @<span class="selector-id">#End</span> <span class="string">&quot;None&quot;</span></span><br><span class="line">fffff800`<span class="number">92411</span>bc2  <span class="number">4</span>e <span class="number">6</span>f <span class="number">6</span>e <span class="number">65</span> e9 <span class="number">45</span> <span class="number">04</span> <span class="number">26</span>-<span class="number">00</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span> <span class="number">90</span>  None<span class="selector-class">.E</span>.&amp;........</span><br><span class="line">kd&gt; u fffff800`<span class="number">92411</span>bc2-<span class="number">1</span></span><br><span class="line">nt!ExAllocatePool+<span class="number">0</span>x1:</span><br><span class="line">fffff800`<span class="number">92411</span>bc1 b84e6f6e65      mov     eax,<span class="number">656</span>E6F4Eh</span><br><span class="line">fffff800`<span class="number">92411</span>bc6 e945042600      jmp     nt!ExAllocatePoolWithTag (fffff800`<span class="number">92672010</span>)</span><br><span class="line">fffff800`<span class="number">92411</span>bcb <span class="number">90</span>              nop</span><br></pre></td></tr></table></figure>



<p>&#x6587;&#x4EF6;Pooltag.txt&#x5217;&#x51FA;&#x4E86;&#x7531;Windows&#x63D0;&#x4F9B;&#x7684;&#x5185;&#x6838;&#x6A21;&#x5F0F;&#x7EC4;&#x4EF6;&#x548C;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#xFF0C;&#x76F8;&#x5173;&#x6587;&#x4EF6;&#x6216;&#x7EC4;&#x4EF6;&#xFF08;&#x5982;&#x679C;&#x5DF2;&#x77E5;&#xFF09;&#x4EE5;&#x53CA;&#x7EC4;&#x4EF6;&#x540D;&#x79F0;&#x7528;&#x4E8E;&#x6C60;&#x5206;&#x914D;&#x7684;&#x6C60;&#x6807;&#x8BB0;&#x3002; Pooltag.txt&#x968F;Windows&#x8C03;&#x8BD5;&#x5DE5;&#x5177;&#xFF08;&#x5728;triage&#x6587;&#x4EF6;&#x5939;&#x4E2D;&#xFF09;&#x548C;Windows WDK&#xFF08;&#x5728;\ tools \ other \ platform \ poolmon&#x4E2D;&#xFF09;&#x4E00;&#x8D77;&#x5B89;&#x88C5;&#x3002; Pooltag.txt&#x663E;&#x793A;&#x4EE5;&#x4E0B;&#x6807;&#x8BB0;&#xFF1A;</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">None - <span class="symbol">&lt;unknown&gt;</span>    - <span class="keyword">call</span> <span class="keyword">to</span> ExAllocatePool</span><br></pre></td></tr></table></figure>



<p>&#x4E0D;&#x5E78;&#x7684;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x53D1;&#x73B0;&#x5F53;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x8C03;&#x7528;ExAllocatePool&#xFF08;&#x672A;&#x6307;&#x5B9A;&#x6807;&#x8BB0;&#xFF09;&#x65F6;&#x4F1A;&#x4F7F;&#x7528;&#x6B64;&#x6807;&#x8BB0;&#x3002; &#x8FD9;&#x4E0D;&#x5141;&#x8BB8;&#x6211;&#x4EEC;&#x786E;&#x5B9A;&#x5728;&#x635F;&#x574F;&#x4E4B;&#x524D;&#x5206;&#x914D;&#x5757;&#x7684;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x3002; &#x5373;&#x4F7F;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C06;&#x6807;&#x8BB0;&#x7ED1;&#x5B9A;&#x56DE;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#xFF0C;&#x4E5F;&#x53EF;&#x80FD;&#x4E0D;&#x8DB3;&#x4EE5;&#x65AD;&#x5B9A;&#x4F7F;&#x7528;&#x6B64;&#x6807;&#x8BB0;&#x7684;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x662F;&#x7834;&#x574F;&#x5185;&#x5B58;&#x7684;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x3002;</p>
<p>&#x4E0B;&#x4E00;&#x6B65;&#x5E94;&#x8BE5;&#x662F;&#x542F;&#x7528;&#x7279;&#x6B8A;&#x6C60;&#x5E76;&#x5E0C;&#x671B;&#x5728;&#x884C;&#x4E3A;&#x4E2D;&#x6355;&#x83B7;&#x635F;&#x574F;&#x8005;&#x3002;</p>
<h4 id="Part2-Special-Pool-for-Buffer-Overruns"><a href="#Part2-Special-Pool-for-Buffer-Overruns" class="headerlink" title="Part2  Special Pool for Buffer Overruns"></a><strong>Part2</strong>  <strong>Special Pool for Buffer Overruns</strong></h4><p>&#x5728;&#x672C;&#x8282;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x8BA8;&#x8BBA;&#x7279;&#x6B8A;&#x6C60;&#x5982;&#x4F55;&#x5E2E;&#x52A9;&#x8BC6;&#x522B;&#x5411;&#x7F13;&#x51B2;&#x533A;&#x5199;&#x5165;&#x592A;&#x591A;&#x6570;&#x636E;&#x7684;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x3002;</p>
<p>&#x6C60;&#x901A;&#x5E38;&#x88AB;&#x7EC4;&#x7EC7;&#x4E3A;&#x5141;&#x8BB8;&#x591A;&#x4E2A;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x5C06;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x5728;&#x540C;&#x4E00;&#x5185;&#x5B58;&#x9875;&#x4E2D;&#xFF0C;&#x5982;&#x56FE;1&#x6240;&#x793A;&#x3002;</p>
<p><img src="/2019/07/23/20190723-3/2.png" alt="img"></p>
<p>&#x200B;                                                                        &#x56FE;1 &#x672A;&#x635F;&#x574F;&#x6C60;</p>
<p>&#x901A;&#x8FC7;&#x5141;&#x8BB8;&#x591A;&#x4E2A;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x5171;&#x4EAB;&#x540C;&#x4E00;&#x9875;&#x9762;&#xFF0C;&#x6C60;&#x53EF;&#x4EE5;&#x6709;&#x6548;&#x5730;&#x4F7F;&#x7528;&#x53EF;&#x7528;&#x7684;&#x5185;&#x6838;&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#x3002; &#x4F46;&#x662F;&#xFF0C;&#x8FD9;&#x79CD;&#x5171;&#x4EAB;&#x8981;&#x6C42;&#x6BCF;&#x4E2A;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x90FD;&#x8981;&#x5C0F;&#x5FC3;&#x4F7F;&#x7528;&#x6C60;&#xFF0C;&#x4F7F;&#x7528;&#x6C60;&#x7684;&#x4EFB;&#x4F55;&#x9519;&#x8BEF;&#x90FD;&#x53EF;&#x80FD;&#x7834;&#x574F;&#x5176;&#x4ED6;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x6C60;&#x5E76;&#x5BFC;&#x81F4;&#x5D29;&#x6E83;&#x3002;</p>
<p><img src="/2019/07/23/20190723-3/3.png" alt="img"></p>
<p>&#x200B;                                                                                   &#x56FE;&#x4E8C; &#x635F;&#x574F;&#x6C60;</p>
<p>&#x5982;&#x56FE;2&#x6240;&#x793A;&#x6C60;&#xFF0C;&#x5982;&#x679C;DriverA&#x5206;&#x914D;100&#x4E2A;&#x5B57;&#x8282;&#x4F46;&#x5199;&#x5165;120&#x4E2A;&#x5B57;&#x8282;&#xFF0C;&#x5B83;&#x5C06;&#x8986;&#x76D6;&#x7531;DriverB&#x5B58;&#x50A8;&#x7684;&#x6C60;&#x5934;&#x548C;&#x6570;&#x636E;&#x3002; &#x5728;&#x7B2C;1&#x90E8;&#x5206;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x6F14;&#x793A;&#x4E86;&#x8FD9;&#x79CD;&#x7C7B;&#x578B;&#x7684;&#x7F13;&#x51B2;&#x533A;&#x6EA2;&#x51FA;&#xFF0C;&#x4F46;&#x6211;&#x4EEC;&#x65E0;&#x6CD5;&#x8BC6;&#x522B;&#x54EA;&#x4E9B;&#x4EE3;&#x7801;&#x5BFC;&#x81F4;&#x635F;&#x574F;&#x6C60;&#x3002;</p>
<p>&#x4E3A;&#x4E86;&#x6355;&#x83B7;&#x635F;&#x574F;&#x6C60;&#x7684;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x7279;&#x6B8A;&#x6C60;&#x3002; &#x7279;&#x6B8A;&#x6C60;&#x66F4;&#x6539;&#x6C60;&#x7684;&#x7EC4;&#x7EC7;&#x65B9;&#x5F0F;&#xFF0C;&#x4F7F;&#x5F97;&#x6BCF;&#x4E2A;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x7684;&#x5206;&#x914D;&#x4F4D;&#x4E8E;&#x5355;&#x72EC;&#x7684;&#x5185;&#x5B58;&#x9875;&#x4E2D;&#x3002; &#x8FD9;&#x6709;&#x52A9;&#x4E8E;&#x9632;&#x6B62;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x610F;&#x5916;&#x5199;&#x5165;&#x53E6;&#x4E00;&#x4E2A;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x7684;&#x5185;&#x5B58;&#x3002; &#x7279;&#x6B8A;&#x6C60;&#x4E5F;&#x5728;&#x9875;&#x672B;&#x5C3E;&#x8FDB;&#x884C;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x7684;&#x5206;&#x914D;&#xFF0C;&#x901A;&#x8FC7;&#x5C06;&#x4E0B;&#x4E00;&#x4E2A;&#x865A;&#x62DF;&#x9875;&#x9762;&#x6807;&#x8BB0;&#x4E3A;&#x65E0;&#x6548;&#x5C06;&#x5176;&#x8BBE;&#x7F6E;&#x4E3A;&#x4FDD;&#x62A4;&#x9875;&#x9762;&#x3002;&#x5199;&#x5165;&#x8D85;&#x8FC7;&#x5206;&#x914D;&#x7684;&#x7ED3;&#x5C3E;&#xFF0C;&#x4F1A;&#x5BFC;&#x81F4;&#x4FDD;&#x62A4;&#x9875;&#x9762;&#x8FDB;&#x884C;&#x7ACB;&#x5373;&#x9519;&#x8BEF;&#x68C0;&#x67E5;&#x3002;</p>
<p>&#x7279;&#x6B8A;&#x6C60;&#x8FD8;&#x7528;&#x91CD;&#x590D;&#x6A21;&#x5F0F;&#x586B;&#x5145;&#x9875;&#x9762;&#x7684;&#x672A;&#x4F7F;&#x7528;&#x90E8;&#x5206;&#xFF0C;&#x79F0;&#x4E3A;&#x201C;slop bytes&#x201D;&#x3002; &#x5982;&#x679C;&#x5728;&#x6A21;&#x5F0F;&#x4E2D;&#x53D1;&#x73B0;&#x4EFB;&#x4F55;&#x9519;&#x8BEF;&#xFF0C;&#x5728;&#x91CA;&#x653E;&#x9875;&#x9762;&#x65F6;&#x5C06;&#x68C0;&#x67E5;&#x8FD9;&#x4E9B;slop&#x5B57;&#x8282;&#xFF0C;&#x751F;&#x6210;&#x9519;&#x8BEF;&#x68C0;&#x67E5;&#x4EE5;&#x6307;&#x793A;&#x5185;&#x5B58;&#x5DF2;&#x635F;&#x574F;&#x3002; &#x8FD9;&#x79CD;&#x7C7B;&#x578B;&#x7684;&#x635F;&#x574F;&#x4E0D;&#x662F;&#x7F13;&#x51B2;&#x533A;&#x6EA2;&#x51FA;&#xFF0C;&#x5B83;&#x53EF;&#x80FD;&#x662F;&#x4E0B;&#x6EA2;&#x6216;&#x5176;&#x4ED6;&#x5F62;&#x5F0F;&#x7684;&#x635F;&#x574F;&#x3002;</p>
<p><img src="/2019/07/23/20190723-3/4.png" alt="img"></p>
<p>&#x200B;                                                                                       &#x56FE;3 &#x7279;&#x6B8A;&#x6C60;</p>
<p>&#x7531;&#x4E8E;&#x7279;&#x6B8A;&#x6C60;&#x5C06;&#x6BCF;&#x4E2A;&#x6C60;&#x5206;&#x914D;&#x5B58;&#x50A8;&#x5728;&#x5176;&#x81EA;&#x5DF1;&#x7684;4KB&#x9875;&#x9762;&#x4E2D;&#xFF0C;&#x56E0;&#x6B64;&#x4F1A;&#x5BFC;&#x81F4;&#x5185;&#x5B58;&#x4F7F;&#x7528;&#x91CF;&#x589E;&#x52A0;&#x3002;&#x542F;&#x7528;&#x7279;&#x6B8A;&#x6C60;&#x65F6;&#xFF0C;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x5668;&#x5C06;&#x914D;&#x7F6E;&#x53EF;&#x5728;&#x7CFB;&#x7EDF;&#x4E0A;&#x5206;&#x914D;&#x7279;&#x6B8A;&#x6C60;&#x7684;&#x9650;&#x5236;&#xFF0C;&#x5F53;&#x8FBE;&#x5230;&#x6B64;&#x9650;&#x5236;&#x65F6;&#xFF0C;&#x5C06;&#x4F7F;&#x7528;&#x5E38;&#x89C4;&#x6C60;&#x3002;&#x5BF9;&#x4E8E;&#x6BD4;64&#x4F4D;&#x7CFB;&#x7EDF;&#x5177;&#x6709;&#x66F4;&#x5C11;&#x5185;&#x6838;&#x7A7A;&#x95F4;&#x7684;32&#x4F4D;&#x7CFB;&#x7EDF;&#xFF0C;&#x8FD9;&#x79CD;&#x9650;&#x5236;&#x5C24;&#x5176;&#x660E;&#x663E;&#x3002;</p>
<p>&#x89E3;&#x91CA;&#x4E86;&#x7279;&#x6B8A;&#x6C60;&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#xFF0C;&#x73B0;&#x5728;&#x6765;&#x7528;&#x5B83;&#x3002;</p>
<p>&#x6709;&#x4E24;&#x79CD;&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x542F;&#x7528;&#x7279;&#x6B8A;&#x6C60;&#x3002;&#x9A71;&#x52A8;&#x9A8C;&#x8BC1;&#x7A0B;&#x5E8F;&#x5141;&#x8BB8;&#x5728;&#x7279;&#x5B9A;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x4E0A;&#x542F;&#x7528;&#x7279;&#x6B8A;&#x6C60;&#x3002; KB188831&#x4E2D;&#x63CF;&#x8FF0;&#x7684;PoolTag&#x6CE8;&#x518C;&#x8868;&#x503C;&#x5141;&#x8BB8;&#x4E3A;&#x7279;&#x5B9A;&#x6C60;&#x6807;&#x8BB0;&#x542F;&#x7528;&#x7279;&#x6B8A;&#x6C60;&#x3002;&#x4ECE;Windows Vista&#x548C;Windows Server 2008&#x5F00;&#x59CB;&#xFF0C;&#x9A71;&#x52A8;&#x9A8C;&#x8BC1;&#x7A0B;&#x5E8F;&#x6355;&#x83B7;&#x7279;&#x6B8A;&#x6C60;&#x5206;&#x914D;&#x7684;&#x5176;&#x4ED6;&#x4FE1;&#x606F;&#xFF0C;&#x56E0;&#x6B64;&#x8FD9;&#x901A;&#x5E38;&#x662F;&#x63A8;&#x8350;&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>
<p>&#x8981;&#x4F7F;&#x7528;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x9A8C;&#x8BC1;&#x7A0B;&#x5E8F;&#x542F;&#x7528;&#x7279;&#x6B8A;&#x6C60;&#xFF0C;&#x8BF7;&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x884C;&#xFF0C;&#x6216;&#x4ECE;&#x9A8C;&#x8BC1;&#x7A0B;&#x5E8F;GUI&#x4E2D;&#x9009;&#x62E9;&#x8BE5;&#x9009;&#x9879;&#x3002;&#x4F7F;&#x7528;/ driver&#x6807;&#x5FD7;&#x6307;&#x5B9A;&#x8981;&#x9A8C;&#x8BC1;&#x7684;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#xFF0C;&#x8FD9;&#x662F;&#x5217;&#x51FA;&#x60A8;&#x6000;&#x7591;&#x662F;&#x95EE;&#x9898;&#x539F;&#x56E0;&#x7684;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x7684;&#x4F4D;&#x7F6E;&#x3002;&#x60A8;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x9A8C;&#x8BC1;&#x5DF2;&#x7F16;&#x5199;&#x5E76;&#x5E0C;&#x671B;&#x6D4B;&#x8BD5;&#x7684;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x6216;&#x6700;&#x8FD1;&#x5728;&#x7CFB;&#x7EDF;&#x4E0A;&#x66F4;&#x65B0;&#x7684;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x3002;&#x5728;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#x884C;&#x4E2D;&#xFF0C;&#x6211;&#x53EA;&#x9A8C;&#x8BC1;myfault.sys&#x3002;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x542F;&#x52A8;&#x624D;&#x80FD;&#x542F;&#x7528;&#x7279;&#x6B8A;&#x6C60;&#x3002;</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">verifier <span class="string">/flags</span> 1 <span class="string">/driver</span> myfault.sys</span><br></pre></td></tr></table></figure>

<p>&#x542F;&#x7528;&#x9A8C;&#x8BC1;&#x7A0B;&#x5E8F;&#x5E76;&#x91CD;&#x65B0;&#x542F;&#x52A8;&#x7CFB;&#x7EDF;&#x540E;&#xFF0C;&#x91CD;&#x590D;&#x5BFC;&#x81F4;&#x5D29;&#x6E83;&#x7684;&#x6D3B;&#x52A8;&#x3002; &#x5BF9;&#x4E8E;&#x67D0;&#x4E9B;&#x95EE;&#x9898;&#xFF0C;&#x6D3B;&#x52A8;&#x53EF;&#x80FD;&#x53EA;&#x662F;&#x7B49;&#x5F85;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x3002; &#x5BF9;&#x4E8E;&#x6211;&#x4EEC;&#x7684;&#x6F14;&#x793A;&#xFF0C;&#x6211;&#x4EEC;&#x8FD0;&#x884C;NotMyFault&#xFF08;&#x6709;&#x5173;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;&#x7B2C;1&#x90E8;&#x5206;&#xFF09;&#x3002;</p>
<p>&#x7279;&#x6B8A;&#x6C60;&#x4E2D;&#x7F13;&#x51B2;&#x533A;&#x6EA2;&#x51FA;&#x5BFC;&#x81F4;&#x7684;&#x5D29;&#x6E83;&#x5C06;&#x662F;&#x4E00;&#x4E2A;&#x7EC8;&#x6B62;&#x7801;0xD6&#xFF0C;DRIVER_PAGE_FAULT_BEYOND_END_OF_ALLOCATION&#x3002;</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">kd&gt; !analyze -v</span><br><span class="line"><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="emphasis">***</span>*</span><br><span class="line"><span class="bullet">*                                                                             </span>*</span><br><span class="line"><span class="bullet">*                        </span>Bugcheck Analysis                                    *</span><br><span class="line"><span class="bullet">*                                                                             </span>*</span><br><span class="line"><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="emphasis">***</span>*</span><br><span class="line"> </span><br><span class="line">DRIVER<span class="emphasis">_PAGE_</span>FAULT<span class="emphasis">_BEYOND_</span>END<span class="emphasis">_OF_</span>ALLOCATION (d6)</span><br><span class="line">N bytes of memory was allocated and more than N bytes are being referenced.</span><br><span class="line">This cannot be protected by try-except.</span><br><span class="line">When possible, the guilty driver&apos;s name (Unicode string) is printed on</span><br><span class="line">the bugcheck screen and saved in KiBugCheckDriver.</span><br><span class="line">Arguments:</span><br><span class="line">Arg1: fffff9800b5ff000, memory referenced</span><br><span class="line">Arg2: 0000000000000001, value 0 = read operation, 1 = write operation</span><br><span class="line">Arg3: fffff88004f834eb, if non-zero, the address which referenced memory.</span><br><span class="line">Arg4: 0000000000000000, (reserved)</span><br></pre></td></tr></table></figure>

<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8C03;&#x8BD5;&#x6B64;&#x5D29;&#x6E83;&#x5E76;&#x786E;&#x5B9A;notmyfault.sys&#x5199;&#x5165;&#x6C60;&#x7F13;&#x51B2;&#x533A;&#x4E4B;&#x5916;&#x3002;</p>
<p>&#x8C03;&#x7528;&#x5806;&#x6808;&#x663E;&#x793A;myfault.sys&#x8BBF;&#x95EE;&#x4E86;&#x65E0;&#x6548;&#x5185;&#x5B58;&#xFF0C;&#x8FD9;&#x4F1A;&#x751F;&#x6210;&#x9875;&#x9762;&#x9519;&#x8BEF;&#x3002;</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">kd&gt; k</span><br><span class="line">Child-SP          RetAddr           Call Site</span><br><span class="line">fffff880`04822658 fffff803`721333f1 nt!KeBugCheckEx</span><br><span class="line"><span class="symbol">fffff880`04822660 fffff803`720acacb nt! ?? ::FNODOBFM::`s</span>tring&apos;+<span class="number">0</span>x33c2b</span><br><span class="line">fffff880`04822700 fffff803`7206feee nt!MmAccessFault+<span class="number">0</span>x55b</span><br><span class="line">fffff880`04822840 fffff880`04f834eb nt!KiPageFault+<span class="number">0</span>x16e</span><br><span class="line">fffff880`048229d0 fffff880`04f83727 myfault+<span class="number">0</span>x14eb</span><br><span class="line">fffff880`04822b20 fffff803`72658a4a myfault+<span class="number">0</span>x1727</span><br><span class="line">fffff880`04822b80 fffff803`724476c7 nt!IovCallDriver+<span class="number">0</span>xba</span><br><span class="line">fffff880`04822bd0 fffff803`7245c8a6 nt!IopXxxControlFile+<span class="number">0</span>x7e5</span><br><span class="line">fffff880`04822d60 fffff803`72071453 nt!NtDeviceIoControlFile+<span class="number">0</span>x56</span><br><span class="line">fffff880`04822dd0 <span class="number">000007</span>fc`4fe22c5a nt!KiSystemServiceCopyEnd+<span class="number">0</span>x13</span><br><span class="line"><span class="number">00000000</span>`004debb8 <span class="number">00000000</span>`00000000 <span class="number">0</span>x000007fc`4fe22c5a</span><br></pre></td></tr></table></figure>



<p>&#xFF01;pool&#x547D;&#x4EE4;&#x663E;&#x793A;myfault.sys&#x5F15;&#x7528;&#x7684;&#x5730;&#x5740;&#x662F;&#x7279;&#x6B8A;&#x6C60;&#x3002;</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kd&gt; !pool fffff9800b5ff000</span><br><span class="line">Pool<span class="built_in"> page </span>fffff9800b5ff000 region is Special pool</span><br><span class="line">fffff9800b5ff000: Unable <span class="keyword">to</span> <span class="builtin-name">get</span> contents of special<span class="built_in"> pool </span>block</span><br></pre></td></tr></table></figure>



<p>&#x9875;&#x8868;&#x6761;&#x76EE;&#x663E;&#x793A;&#x8BE5;&#x5730;&#x5740;&#x65E0;&#x6548;&#x3002; &#x8FD9;&#x662F;&#x7279;&#x6B8A;&#x6C60;&#x7528;&#x4E8E;&#x6355;&#x83B7;&#x6EA2;&#x51FA;&#x7684;&#x9632;&#x62A4;&#x9875;&#x9762;&#x3002;</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kd&gt; !pte fffff9800b5ff000</span><br><span class="line">                                           VA fffff9800b5ff000</span><br><span class="line">PXE <span class="keyword">at</span> FFFFF6FB7DBEDF98    PPE <span class="keyword">at</span> FFFFF6FB7DBF3000    PDE <span class="keyword">at</span> FFFFF6FB7E6002D0    PTE <span class="keyword">at</span> FFFFF6FCC005AFF8</span><br><span class="line"><span class="keyword">contains</span> <span class="number">0000000001</span>B8F863  <span class="keyword">contains</span> <span class="number">000000000138E863</span>  <span class="keyword">contains</span> <span class="number">000000001</span>A6A1863  <span class="keyword">contains</span> <span class="number">0000000000000000</span></span><br><span class="line">pfn <span class="number">1</span>b8f      <span class="comment">---DA--KWEV  pfn 138e      ---DA--KWEV  pfn 1a6a1     ---DA--KWEV  not valid</span></span><br></pre></td></tr></table></figure>

<p>&#x6B64;&#x5185;&#x5B58;&#x4E4B;&#x524D;&#x7684;&#x5206;&#x914D;&#x662F;&#x4E00;&#x4E2A;800&#x5B57;&#x8282;&#x7684;&#x975E;&#x5206;&#x9875;&#x6C60;&#x6807;&#x8BB0;&#x4E3A;&#x201C;Wrap&#x201D;&#x3002; &#x201C;Wrap&#x201D;&#x662F;&#x9A8C;&#x8BC1;&#x7A0B;&#x5E8F;&#x5728;&#x6CA1;&#x6709;&#x6807;&#x8BB0;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x5206;&#x914D;&#x6C60;&#x65F6;&#x4F7F;&#x7528;&#x7684;&#x6807;&#x8BB0;&#xFF0C;&#x5B83;&#x76F8;&#x5F53;&#x4E8E;&#x6211;&#x4EEC;&#x5728;&#x7B2C;1&#x90E8;&#x5206;&#x4E2D;&#x770B;&#x5230;&#x7684;&#x201C;None&#x201D;&#x6807;&#x8BB0;&#x3002;</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kd&gt; !pool fffff9800b5ff000-1000</span><br><span class="line">Pool<span class="built_in"> page </span>fffff9800b5fe000 region is Special pool</span><br><span class="line"><span class="number">*fffff9800b5fe000</span> size:  800 data: fffff9800b5fe800 (NonPaged) *Wrap</span><br><span class="line">            Owning component : Unknown (update pooltag.txt)</span><br></pre></td></tr></table></figure>

<p>&#x7279;&#x6B8A;&#x6C60;&#x662F;&#x8DDF;&#x8E2A;&#x7F13;&#x51B2;&#x533A;&#x6EA2;&#x51FA;&#x6C60;&#x635F;&#x574F;&#x7684;&#x6709;&#x6548;&#x673A;&#x5236;&#x3002; &#x5B83;&#x8FD8;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x6355;&#x83B7;&#x5176;&#x4ED6;&#x7C7B;&#x578B;&#x7684;&#x6C60;&#x635F;&#x574F;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x5728;&#x4EE5;&#x540E;&#x7684;&#x6587;&#x7AE0;&#x4E2D;&#x8BA8;&#x8BBA;&#x3002;</p>
<h4 id="Part3-Special-Pool-for-Double-Frees"><a href="#Part3-Special-Pool-for-Double-Frees" class="headerlink" title="Part3 Special Pool for Double Frees"></a><strong>Part3 Special Pool for Double Frees</strong></h4><p>&#x5728;&#x672C;&#x7CFB;&#x5217;&#x7684;&#x7B2C;1&#x90E8;&#x5206;&#x548C;&#x7B2C;2&#x90E8;&#x5206;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x8BA8;&#x8BBA;&#x4E86;&#x6C60;&#x635F;&#x574F;&#x4EE5;&#x53CA;&#x5982;&#x4F55;&#x4F7F;&#x7528;&#x7279;&#x6B8A;&#x6C60;&#x6765;&#x786E;&#x5B9A;&#x6B64;&#x7C7B;&#x635F;&#x574F;&#x7684;&#x539F;&#x56E0;&#x3002; &#x5728;&#x8FD9;&#x4E00;&#x90E8;&#x5206;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x4F7F;&#x7528;&#x7279;&#x6B8A;&#x6C60;&#x6765;&#x6355;&#x83B7;&#x4E00;&#x4E2A;&#x53CC;&#x91CD;&#x91CA;&#x653E;&#x6C60;&#x5185;&#x5B58;&#x3002;</p>
<p>&#x53CC;&#x91CD;&#x91CA;&#x653E;&#x6C60;&#x5C06;&#x5BFC;&#x81F4;&#x7CFB;&#x7EDF;&#x663E;&#x793A;&#x84DD;&#x5C4F;&#xFF0C;&#x4F46;&#x662F;&#x7531;&#x6B64;&#x5BFC;&#x81F4;&#x7684;&#x5D29;&#x6E83;&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x6240;&#x4E0D;&#x540C;&#x3002; &#x5728;&#x6700;&#x660E;&#x663E;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4E24;&#x6B21;&#x91CA;&#x653E;&#x6C60;&#x5206;&#x914D;&#x7684;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x5C06;&#x5BFC;&#x81F4;&#x7CFB;&#x7EDF;&#x7ACB;&#x5373;&#x5D29;&#x6E83;&#xFF0C;&#x7EC8;&#x6B62;&#x7801;&#x4E3A;C2 BAD_POOL_CALLER&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x5C06;&#x4E3A;7&#xFF0C;&#x8868;&#x793A;&#x201C;&#x5C1D;&#x8BD5;&#x91CA;&#x653E;&#x5DF2;&#x91CA;&#x653E;&#x7684;&#x6C60;&#x201D;&#x3002; &#x5982;&#x679C;&#x60A8;&#x9047;&#x5230;&#x6B64;&#x7C7B;&#x5D29;&#x6E83;&#xFF0C;&#x5219;&#x5E94;&#x5728;&#x6545;&#x969C;&#x6392;&#x9664;&#x6B65;&#x9AA4;&#x5217;&#x8868;&#x4E2D;&#x542F;&#x7528;&#x7279;&#x6B8A;&#x6C60;&#x3002;</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">BAD_POOL_CALLER (c2)</span><br><span class="line">The current thread is making a bad<span class="built_in"> pool </span>request.  Typically this is at a bad IRQL level <span class="keyword">or</span> double freeing the same allocation, etc.</span><br><span class="line">Arguments:</span><br><span class="line">Arg1: 0000000000000007, Attempt <span class="keyword">to</span> free<span class="built_in"> pool </span>which was already freed</span><br><span class="line">Arg2: 00000000000011c1, (reserved)</span><br><span class="line">Arg3: 0000000004810007, Memory contents of the<span class="built_in"> pool </span>block</span><br><span class="line">Arg4: fffffa8001b10800,<span class="built_in"> Address </span>of the block of<span class="built_in"> pool </span>being deallocated</span><br></pre></td></tr></table></figure>

<p>&#x4E00;&#x4E2A;&#x4E0D;&#x592A;&#x660E;&#x663E;&#x7684;&#x5D29;&#x6E83;&#x662F;&#x6C60;&#x5DF2;&#x88AB;&#x91CD;&#x65B0;&#x7533;&#x8BF7;&#x3002;&#x6B63;&#x5982;&#x7B2C;&#x4E8C;&#x90E8;&#x5206;&#x6240;&#x793A;&#xFF0C;&#x6C60;&#x7684;&#x7ED3;&#x6784;&#x4F7F;&#x5F97;&#x591A;&#x4E2A;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x5171;&#x4EAB;&#x4E00;&#x4E2A;&#x9875;&#x9762;&#x3002;&#x5F53;DriverA&#x8C03;&#x7528;ExFreePool&#x91CA;&#x653E;&#x5176;&#x6C60;&#x5757;&#x65F6;&#xFF0C;&#x8BE5;&#x5757;&#x53EF;&#x4F9B;&#x5176;&#x4ED6;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x4F7F;&#x7528;&#x3002; &#x5982;&#x679C;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x5668;&#x5C06;&#x6B64;&#x5185;&#x5B58;&#x63D0;&#x4F9B;&#x7ED9;DriverF&#xFF0C;&#x7136;&#x540E;DriverA&#x518D;&#x6B21;&#x91CA;&#x653E;&#x5B83;&#xFF0C;&#x5219;&#x5F53;&#x6C60;&#x5206;&#x914D;&#x4E0D;&#x518D;&#x5305;&#x542B;&#x9884;&#x671F;&#x6570;&#x636E;&#x65F6;&#xFF0C;DriverF&#x4E2D;&#x53EF;&#x80FD;&#x4F1A;&#x53D1;&#x751F;&#x5D29;&#x6E83;&#x3002; &#x5BF9;&#x4E8E;&#x6CA1;&#x6709;&#x7279;&#x6B8A;&#x6C60;&#x7684;DriverF&#x7684;&#x5F00;&#x53D1;&#x8005;&#x6765;&#x8BF4;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x95EE;&#x9898;&#x53EF;&#x80FD;&#x662F;&#x56F0;&#x96BE;&#x7684;&#x3002;</p>
<p><img src="/2019/07/23/20190723-3/5.png" alt="img"></p>
<p>&#x7279;&#x6B8A;&#x6C60;&#x5C06;&#x6BCF;&#x4E2A;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x7684;&#x5206;&#x914D;&#x653E;&#x5728;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684;&#x5185;&#x5B58;&#x9875;&#x4E2D;&#xFF08;&#x5982;&#x7B2C;2&#x90E8;&#x5206;&#x6240;&#x8FF0;&#xFF09;&#x3002; &#x5F53;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x91CA;&#x653E;&#x7279;&#x6B8A;&#x6C60;&#x4E2D;&#x7684;&#x6C60;&#x5757;&#x65F6;&#xFF0C;&#x5C06;&#x91CA;&#x653E;&#x6574;&#x4E2A;&#x9875;&#x9762;&#xFF0C;&#x5E76;&#x4E14;&#x5BF9;&#x4EFB;&#x610F;&#x9875;&#x9762;&#x7684;&#x4EFB;&#x4F55;&#x8BBF;&#x95EE;&#x90FD;&#x5C06;&#x5BFC;&#x81F4;&#x7ACB;&#x5373;&#x9519;&#x8BEF;&#x68C0;&#x67E5;&#x3002; &#x6B64;&#x5916;&#xFF0C;&#x7279;&#x6B8A;&#x6C60;&#x5C06;&#x6B64;&#x9875;&#x9762;&#x653E;&#x5728;&#x8981;&#x518D;&#x6B21;&#x4F7F;&#x7528;&#x7684;&#x9875;&#x9762;&#x5217;&#x8868;&#x7684;&#x5C3E;&#x90E8;&#x3002; &#x8FD9;&#x589E;&#x52A0;&#x4E86;&#x9875;&#x9762;&#x5728;&#x7B2C;&#x4E8C;&#x6B21;&#x91CA;&#x653E;&#x65F6;&#x4ECD;&#x7136;&#x53EF;&#x7528;&#x7684;&#x53EF;&#x80FD;&#x6027;&#xFF0C;&#x964D;&#x4F4E;&#x4E86;&#x4E0A;&#x9762;&#x663E;&#x793A;&#x7684;DriverA / DriverF&#x573A;&#x666F;&#x7684;&#x53EF;&#x80FD;&#x6027;&#x3002;</p>
<p>&#x4E3A;&#x4E86;&#x9A8C;&#x8BC1;&#x8FD9;&#x79CD;&#x5931;&#x8D25;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x518D;&#x6B21;&#x4F7F;&#x7528;Sysinternals&#x5DE5;&#x5177;NotMyFault&#x3002; &#x9009;&#x62E9;&#x201C;Double free&#x201D;&#x9009;&#x9879;&#xFF0C;&#x7136;&#x540E;&#x5355;&#x51FB;&#x201C;Crash&#x201D;&#x3002; &#x5F88;&#x53EF;&#x80FD;&#x4F60;&#x4F1A;&#x5F97;&#x5230;&#x4E0A;&#x9762;&#x63D0;&#x5230;&#x7684;&#x505C;&#x6B62;C2&#x9519;&#x8BEF;&#x68C0;&#x67E5;&#x3002; &#x542F;&#x7528;&#x7279;&#x6B8A;&#x6C60;&#x5E76;&#x91CD;&#x65B0;&#x542F;&#x52A8;&#x4EE5;&#x83B7;&#x5F97;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#x9519;&#x8BEF;&#x3002;</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">verifier <span class="string">/flags</span> 1 <span class="string">/driver</span> myfault.sys</span><br></pre></td></tr></table></figure>



<p>&#x9009;&#x62E9;&#x542F;&#x7528;&#x7279;&#x6B8A;&#x6C60;&#x7684;&#x201C;&#x53CC;&#x91CD;&#x514D;&#x8D39;&#x201D;&#x9009;&#x9879;&#x4F1A;&#x5BFC;&#x81F4;&#x4EE5;&#x4E0B;&#x5D29;&#x6E83;&#x3002; &#x9519;&#x8BEF;&#x68C0;&#x67E5;&#x4EE3;&#x7801;PAGE_FAULT_IN_NONPAGED_AREA&#x8868;&#x793A;&#x67D0;&#x4E9B;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x8BD5;&#x56FE;&#x8BBF;&#x95EE;&#x65E0;&#x6548;&#x7684;&#x5185;&#x5B58;&#x3002; &#x6B64;&#x65E0;&#x6548;&#x5185;&#x5B58;&#x662F;&#x5DF2;&#x91CA;&#x653E;&#x7684;&#x7279;&#x6B8A;&#x6C60;&#x9875;&#x9762;&#x3002;</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PAGE_FAULT_IN_NONPAGED_AREA (50)</span><br><span class="line">Invalid<span class="built_in"> system </span>memory was referenced.  This cannot be protected by try-except,</span><br><span class="line">it must be protected by a Probe.  Typically the<span class="built_in"> address </span>is just plain bad <span class="keyword">or</span> it</span><br><span class="line">is pointing at freed memory.</span><br><span class="line">Arguments:</span><br><span class="line">Arg1: fffff9800a7fe7f0, memory referenced.</span><br><span class="line">Arg2: 0000000000000000, value 0 = read operation, 1 = write operation.</span><br><span class="line">Arg3: fffff80060263888, <span class="keyword">If</span> non-zero, the instruction<span class="built_in"> address </span>which referenced the bad memory address.</span><br><span class="line">Arg4: 0000000000000002, (reserved)</span><br></pre></td></tr></table></figure>

<p>&#x67E5;&#x770B;&#x8C03;&#x7528;&#x5806;&#x6808;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;myfault.sys&#x6B63;&#x5728;&#x91CA;&#x653E;&#x6C60;&#xFF0C;ExFreePoolSanityChecks&#x53D1;&#x751F;&#x4E86;&#x5BFC;&#x81F4;&#x5D29;&#x6E83;&#x7684;&#x9875;&#x9762;&#x9519;&#x8BEF;&#x3002;</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">kd&gt; kn</span><br><span class="line"># Child-SP          RetAddr           Call Site</span><br><span class="line"><span class="number">00</span> fffff880`0419fe28 fffff800`5fd7e28a nt!DbgBreakPointWithStatus</span><br><span class="line"><span class="number">01</span> fffff880`0419fe30 fffff800`5fd7d8de nt!KiBugCheckDebugBreak+<span class="number">0</span>x12</span><br><span class="line"><span class="number">02</span> fffff880`0419fe90 fffff800`5fc5b544 nt!KeBugCheck2+<span class="number">0</span>x79f</span><br><span class="line"><span class="number">03</span> fffff880`041a05b0 fffff800`5fd1c5bc nt!KeBugCheckEx+<span class="number">0</span>x104</span><br><span class="line"><span class="number">04</span> fffff880`041a05f0 fffff800`5fc95acb nt! ?? ::FNODOBFM::`string&apos;+<span class="number">0</span>x33e2a</span><br><span class="line"><span class="number">05</span> fffff880`041a0690 fffff800`5fc58eee nt!MmAccessFault+<span class="number">0</span>x55b</span><br><span class="line"><span class="number">06</span> fffff880`041a07d0 fffff800`60263888 nt!KiPageFault+<span class="number">0</span>x16e</span><br><span class="line"><span class="number">07</span> fffff880`041a0960 fffff800`6024258c nt!ExFreePoolSanityChecks+<span class="number">0</span>xe8</span><br><span class="line"><span class="number">08</span> fffff880`041a09a0 fffff880`04c9b5d9 nt!VerifierExFreePoolWithTag+<span class="number">0</span>x3c</span><br><span class="line"><span class="number">09</span> fffff880`041a09d0 fffff880`04c9b727 myfault!MyfaultDeviceControl+<span class="number">0</span>x2fd</span><br><span class="line"><span class="number">0</span><span class="literal">a</span> fffff880`041a0b20 fffff800`60241a4a myfault!MyfaultDispatch+<span class="number">0</span>xb7</span><br><span class="line"><span class="number">0</span>b fffff880`041a0b80 fffff800`600306c7 nt!IovCallDriver+<span class="number">0</span>xba</span><br><span class="line"><span class="number">0</span>c fffff880`041a0bd0 fffff800`600458a6 nt!IopXxxControlFile+<span class="number">0</span>x7e5</span><br><span class="line"><span class="number">0</span>d fffff880`041a0d60 fffff800`5fc5a453 nt!NtDeviceIoControlFile+<span class="number">0</span>x56</span><br><span class="line"><span class="number">0</span>e fffff880`041a0dd0 <span class="number">000007</span>fd`ea212c5a nt!KiSystemServiceCopyEnd+<span class="number">0</span>x13</span><br></pre></td></tr></table></figure>

<p>&#x4F7F;&#x7528;&#x9519;&#x8BEF;&#x68C0;&#x67E5;&#x4EE3;&#x7801;&#x4E2D;&#x7684;&#x5730;&#x5740;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5185;&#x5B58;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x65E0;&#x6548;&#x7684;&#xFF1A;</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">kd&gt; dd fffff9800a7fe7f0</span><br><span class="line">fffff980`<span class="number">0</span>a7fe7f0  ???????? ???????? ???????? ????????</span><br><span class="line">fffff980`<span class="number">0</span>a7fe800  ???????? ???????? ???????? ????????</span><br><span class="line">fffff980`<span class="number">0</span>a7fe810  ???????? ???????? ???????? ????????</span><br><span class="line">fffff980`<span class="number">0</span>a7fe820  ???????? ???????? ???????? ????????</span><br><span class="line">fffff980`<span class="number">0</span>a7fe830  ???????? ???????? ???????? ????????</span><br><span class="line">fffff980`<span class="number">0</span>a7fe840  ???????? ???????? ???????? ????????</span><br><span class="line">fffff980`<span class="number">0</span>a7fe850  ???????? ???????? ???????? ????????</span><br><span class="line">fffff980`<span class="number">0</span>a7fe860  ???????? ???????? ???????? ????????</span><br><span class="line">    </span><br><span class="line">kd&gt; !pte fffff9800a7fe7f0</span><br><span class="line">                                           VA fffff9800a7fe7f0</span><br><span class="line">PXE at FFFFF6FB7DBEDF98    PPE at FFFFF6FB7DBF3000    PDE at FFFFF6FB7E600298    PTE at FFFFF6FCC0053FF0</span><br><span class="line">contains <span class="number">0000000002</span>A91863  contains <span class="number">0000000002</span>A10863  contains <span class="number">0000000000000000</span></span><br><span class="line">pfn <span class="number">2</span>a91      ---DA--KWEV  pfn <span class="number">2</span>a10      ---DA--KWEV  not valid</span><br></pre></td></tr></table></figure>



<p>&#x5230;&#x76EE;&#x524D;&#x4E3A;&#x6B62;&#xFF0C;&#x6211;&#x4EEC;&#x6709;&#x8DB3;&#x591F;&#x7684;&#x8BC1;&#x636E;&#x8BC1;&#x660E;myfault.sys&#x91CA;&#x653E;&#x4E86;&#x65E0;&#x6548;&#x7684;&#x5185;&#x5B58;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x600E;&#x4E48;&#x77E5;&#x9053;&#x8FD9;&#x4E2A;&#x5185;&#x5B58;&#x88AB;&#x91CA;&#x653E;&#x4E86;&#x4E24;&#x6B21;&#x5462;&#xFF1F; &#x5982;&#x679C;&#x6709;&#x53CC;&#x91CD;&#x91CA;&#x653E;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x786E;&#x5B9A;&#x5BF9;ExFreePool&#x7684;&#x7B2C;&#x4E00;&#x6B21;&#x6216;&#x7B2C;&#x4E8C;&#x6B21;&#x8C03;&#x7528;&#x662F;&#x5426;&#x4E0D;&#x6B63;&#x786E;&#x3002; &#x4E3A;&#x6B64;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x786E;&#x5B9A;&#x54EA;&#x4E9B;&#x4EE3;&#x7801;&#x9996;&#x5148;&#x91CA;&#x653E;&#x4E86;&#x5185;&#x5B58;&#x3002;</p>
<p>Driver Verifier&#x7279;&#x6B8A;&#x6C60;&#x8DDF;&#x8E2A;&#x6700;&#x540E;&#x7684;0x10000&#x8C03;&#x7528;&#x4EE5;&#x5206;&#x914D;&#x548C;&#x91CA;&#x653E;&#x6C60;&#x3002; &#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#xFF01;verifier 80&#x547D;&#x4EE4;&#x8F6C;&#x50A8;&#x6B64;&#x6570;&#x636E;&#x5E93;&#x3002; &#x8981;&#x9650;&#x5236;&#x6570;&#x636E;&#x8F93;&#x51FA;&#xFF0C;&#x60A8;&#x8FD8;&#x53EF;&#x4EE5;&#x5C06;&#x6B64;&#x547D;&#x4EE4;&#x4F20;&#x9012;&#x7ED9;&#x60A8;&#x6000;&#x7591;&#x88AB;&#x53CC;&#x91CD;&#x91CA;&#x653E;&#x7684;&#x5185;&#x5B58;&#x5730;&#x5740;&#x3002;</p>
<p>&#x4E0D;&#x8981;&#x5047;&#x8BBE;&#x9519;&#x8BEF;&#x68C0;&#x67E5;&#x4EE3;&#x7801;&#x4E2D;&#x7684;&#x5730;&#x5740;&#x662F;&#x88AB;&#x91CA;&#x653E;&#x7684;&#x5730;&#x5740;&#xFF0C;&#x8BF7;&#x4ECE;&#x8C03;&#x7528;VerifierExFreePoolWithTag&#x7684;&#x51FD;&#x6570;&#x4E2D;&#x83B7;&#x53D6;&#x5730;&#x5740;&#x3002;</p>
<p>&#x5728;&#x4E0A;&#x9762;&#x7684;&#x8C03;&#x7528;&#x5806;&#x6808;&#x4E2D;&#xFF0C;VerifierExFreePoolWithTag&#x4E0B;&#x9762;&#x7684;&#x8C03;&#x7528;&#x662F;&#x7B2C;9&#x5E27;&#xFF08;&#x4ECE;0&#x5F00;&#x59CB;&#x8BA1;&#x6570;&#xFF0C;&#x6216;&#x8005;&#x4F7F;&#x7528;kn&#xFF09;&#x3002;</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">kd&gt; .frame /r 9</span><br><span class="line">09 fffff880`041a09d0 fffff880`04c9b727 myfault+0x15d9</span><br><span class="line"><span class="attribute">rax</span>=0000000000000000 <span class="attribute">rbx</span>=fffff9800a7fe800 <span class="attribute">rcx</span>=fffff9800a7fe800</span><br><span class="line"><span class="attribute">rdx</span>=fffffa8001a37fa0 <span class="attribute">rsi</span>=fffffa80035975e0 <span class="attribute">rdi</span>=fffffa8003597610</span><br><span class="line"><span class="attribute">rip</span>=fffff88004c9b5d9 <span class="attribute">rsp</span>=fffff880041a09d0 <span class="attribute">rbp</span>=fffffa80034568d0</span><br><span class="line"><span class="attribute">r8</span>=fffff9800a7fe801  <span class="attribute">r9</span>=fffff9800a7fe7f0 <span class="attribute">r10</span>=fffff9800a7fe800</span><br><span class="line"><span class="attribute">r11</span>=0000000000000000 <span class="attribute">r12</span>=0000000000000000 <span class="attribute">r13</span>=0000000000000000</span><br><span class="line"><span class="attribute">r14</span>=fffff800600306c7 <span class="attribute">r15</span>=fffffa8004381b80</span><br><span class="line"><span class="attribute">iopl</span>=0         nv up ei ng nz na po nc</span><br><span class="line"><span class="attribute">cs</span>=0010  <span class="attribute">ss</span>=0018  <span class="attribute">ds</span>=002b  <span class="attribute">es</span>=002b  <span class="attribute">fs</span>=0053  <span class="attribute">gs</span>=002b             <span class="attribute">efl</span>=00000286</span><br><span class="line">myfault+0x15d9:</span><br><span class="line">fffff880`04c9b5d9 eb7a            jmp     myfault+0x1655 (fffff880`04c9b655)</span><br></pre></td></tr></table></figure>

<p>&#x5728;x64&#x7CFB;&#x7EDF;&#x4E0A;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x5728;rcx&#x4E2D;&#x4F20;&#x9012;&#x3002; &#x4E0B;&#x9762;&#x7684;&#x7A0B;&#x5E8F;&#x96C6;&#x663E;&#x793A;rcx&#x6E90;&#x81EA;rbx&#x3002;</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">kd&gt; ub fffff<span class="number">880</span>`<span class="number">04</span><span class="keyword">c</span><span class="number">9</span>b<span class="number">5</span>d<span class="number">9</span></span><br><span class="line">myfault+<span class="number">0x15ba</span>:</span><br><span class="line">fffff<span class="number">880</span>`<span class="number">04</span><span class="keyword">c</span><span class="number">9</span>b<span class="number">5</span>ba ff<span class="number">15</span>a<span class="number">80</span>a<span class="number">0000</span>    <span class="keyword">call</span>    qword ptr [myfault+<span class="number">0x2068</span> (fffff<span class="number">880</span>`<span class="number">04</span><span class="keyword">c</span><span class="number">9</span><span class="keyword">c</span><span class="number">068</span>)]</span><br><span class="line">fffff<span class="number">880</span>`<span class="number">04</span><span class="keyword">c</span><span class="number">9</span>b<span class="number">5</span><span class="keyword">c</span><span class="number">0</span> <span class="number">33</span>d<span class="number">2</span>            <span class="keyword">xor</span>     edx,edx</span><br><span class="line">fffff<span class="number">880</span>`<span class="number">04</span><span class="keyword">c</span><span class="number">9</span>b<span class="number">5</span><span class="keyword">c</span><span class="number">2</span> <span class="number">488</span>bc<span class="number">8</span>          mov     rcx,rax</span><br><span class="line">fffff<span class="number">880</span>`<span class="number">04</span><span class="keyword">c</span><span class="number">9</span>b<span class="number">5</span><span class="keyword">c</span><span class="number">5</span> <span class="number">488</span>bd<span class="number">8</span>          mov     rbx,rax</span><br><span class="line">fffff<span class="number">880</span>`<span class="number">04</span><span class="keyword">c</span><span class="number">9</span>b<span class="number">5</span><span class="keyword">c</span><span class="number">8</span> ff<span class="number">154</span>a<span class="number">0</span>a<span class="number">0000</span>    <span class="keyword">call</span>    qword ptr [myfault+<span class="number">0x2018</span> (fffff<span class="number">880</span>`<span class="number">04</span><span class="keyword">c</span><span class="number">9</span><span class="keyword">c</span><span class="number">018</span>)]</span><br><span class="line">fffff<span class="number">880</span>`<span class="number">04</span><span class="keyword">c</span><span class="number">9</span>b<span class="number">5</span>ce <span class="number">33</span>d<span class="number">2</span>            <span class="keyword">xor</span>     edx,edx</span><br><span class="line">fffff<span class="number">880</span>`<span class="number">04</span><span class="keyword">c</span><span class="number">9</span>b<span class="number">5</span>d<span class="number">0</span> <span class="number">488</span>bcb          mov    rcx,rbx</span><br><span class="line">fffff<span class="number">880</span>`<span class="number">04</span><span class="keyword">c</span><span class="number">9</span>b<span class="number">5</span>d<span class="number">3</span> ff<span class="number">153</span>f<span class="number">0</span>a<span class="number">0000</span>    <span class="keyword">call</span>    qword ptr [myfault+<span class="number">0x2018</span> (fffff<span class="number">880</span>`<span class="number">04</span><span class="keyword">c</span><span class="number">9</span><span class="keyword">c</span><span class="number">018</span>)]</span><br></pre></td></tr></table></figure>

<p>&#x8FD0;&#x884C;&#xFF01;verifier 80&#xFF1A;rbx&#x4E2D;&#x7684;&#x5730;&#x5740;</p>
<figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kd&gt; !verifier <span class="number">80</span> fffff9800a7fe800</span><br></pre></td></tr></table></figure>

<p>&#x6700;&#x8FD1;&#x5185;&#x6838;&#x6C60;&#x5206;&#x914D;&#x548C;&#x81EA;&#x7531;&#x64CD;&#x4F5C;&#x7684;&#x65E5;&#x5FD7;&#xFF1A;</p>
<p>&#x65E5;&#x5FD7;&#x4E2D;&#x6700;&#x591A;&#x6709;0x10000&#x4E2A;&#x6761;&#x76EE;&#x3002;</p>
<p>&#x89E3;&#x6790;0x0000000000010000&#x4E2A;&#x65E5;&#x5FD7;&#x6761;&#x76EE;&#xFF0C;&#x641C;&#x7D22;&#x5730;&#x5740;0xfffff9800a7fe800&#x3002;</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">======================================================================</span><br><span class="line">Pool block fffff<span class="number">9800</span>a<span class="number">7</span>fe<span class="number">800</span>, Size <span class="number">0000000000000800</span>, Thread fffffa<span class="number">80046</span>ce<span class="number">4</span><span class="keyword">c</span><span class="number">0</span></span><br><span class="line">fffff<span class="number">80060251</span>a<span class="number">32</span> nt<span class="title">!VfFreePoolNotification</span>+<span class="number">0x4a</span></span><br><span class="line">fffff<span class="number">8005</span>fe<span class="number">736</span><span class="keyword">c</span><span class="number">9</span> nt<span class="title">!ExFreePool</span>+<span class="number">0x595</span></span><br><span class="line">fffff<span class="number">80060242597</span> nt<span class="title">!VerifierExFreePoolWithTag</span>+<span class="number">0x47</span></span><br><span class="line">fffff<span class="number">88004</span><span class="keyword">c</span><span class="number">9</span>b<span class="number">5</span>ce myfault<span class="title">!MyfaultDeviceControl</span>+<span class="number">0x2f2</span></span><br><span class="line">fffff<span class="number">88004</span><span class="keyword">c</span><span class="number">9</span>b<span class="number">727</span> myfault<span class="title">!MyfaultDispatch</span>+<span class="number">0xb7</span></span><br><span class="line">fffff<span class="number">80060241</span>a<span class="number">4</span>a nt<span class="title">!IovCallDriver</span>+<span class="number">0xba</span></span><br><span class="line">fffff<span class="number">800600306</span><span class="keyword">c</span><span class="number">7</span> nt<span class="title">!IopXxxControlFile</span>+<span class="number">0x7e5</span></span><br><span class="line">fffff<span class="number">800600458</span>a<span class="number">6</span> nt<span class="title">!NtDeviceIoControlFile</span>+<span class="number">0x56</span></span><br><span class="line">fffff<span class="number">8005</span>fc<span class="number">5</span>a<span class="number">453</span> nt<span class="title">!KiSystemServiceCopyEnd</span>+<span class="number">0x13</span></span><br><span class="line">======================================================================</span><br><span class="line">Pool block fffff<span class="number">9800</span>a<span class="number">7</span>fe<span class="number">800</span>, Size <span class="number">0000000000000800</span>, Thread fffffa<span class="number">80046</span>ce<span class="number">4</span><span class="keyword">c</span><span class="number">0</span></span><br><span class="line">fffff<span class="number">80060242</span>a<span class="number">5</span>d nt<span class="title">!VeAllocatePoolWithTagPriority</span>+<span class="number">0x2d1</span></span><br><span class="line">fffff<span class="number">8006024</span>b<span class="number">20</span>e nt<span class="title">!XdvExAllocatePoolInternal</span>+<span class="number">0x12</span></span><br><span class="line">fffff<span class="number">80060242</span>f<span class="number">69</span> nt<span class="title">!VerifierExAllocatePool</span>+<span class="number">0x61</span></span><br><span class="line">fffff<span class="number">88004</span><span class="keyword">c</span><span class="number">9</span>b<span class="number">5</span><span class="keyword">c</span><span class="number">0</span> myfault<span class="title">!MyfaultDeviceControl</span>+<span class="number">0x2e4</span></span><br><span class="line">fffff<span class="number">88004</span><span class="keyword">c</span><span class="number">9</span>b<span class="number">727</span> myfault<span class="title">!MyfaultDispatch</span>+<span class="number">0xb7</span></span><br><span class="line">fffff<span class="number">80060241</span>a<span class="number">4</span>a nt<span class="title">!IovCallDriver</span>+<span class="number">0xba</span></span><br><span class="line">fffff<span class="number">800600306</span><span class="keyword">c</span><span class="number">7</span> nt<span class="title">!IopXxxControlFile</span>+<span class="number">0x7e5</span></span><br><span class="line">fffff<span class="number">800600458</span>a<span class="number">6</span> nt<span class="title">!NtDeviceIoControlFile</span>+<span class="number">0x56</span></span><br><span class="line">fffff<span class="number">8005</span>fc<span class="number">5</span>a<span class="number">453</span> nt<span class="title">!KiSystemServiceCopyEnd</span>+<span class="number">0x13</span></span><br></pre></td></tr></table></figure>

<p>&#x4E0A;&#x9762;&#x7684;&#x8F93;&#x51FA;&#x663E;&#x793A;&#x7531;myfault.sys&#x5206;&#x914D;&#x7684;&#x6C60;&#x5757;&#xFF0C;&#x7136;&#x540E;&#x7531;myfault.sys&#x91CA;&#x653E;&#x3002; &#x5982;&#x679C;&#x6211;&#x4EEC;&#x5C06;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#x4E0E;&#x8C03;&#x7528;&#x5806;&#x6808;&#x7ED3;&#x5408;&#x8D77;&#x6765;&#x5BFC;&#x81F4;&#x6211;&#x4EEC;&#x7684;&#x9519;&#x8BEF;&#x68C0;&#x67E5;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F97;&#x51FA;&#x7ED3;&#x8BBA;&#xFF0C;&#x6C60;&#x5728;MyfaultDeviceControl&#x4E2D;&#x5728;&#x504F;&#x79FB;&#x91CF;0x2f2&#x5904;&#x88AB;&#x91CA;&#x653E;&#x4E00;&#x6B21;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x504F;&#x79FB;&#x91CF;&#x4E3A;0x2fd&#x7684;MyfaultDeviceControl&#x4E2D;&#x518D;&#x6B21;&#x91CA;&#x653E;&#x3002;</p>
<p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x54EA;&#x4E2A;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x5BFC;&#x81F4;&#x4E86;&#x95EE;&#x9898;&#xFF0C;&#x5982;&#x679C;&#x8FD9;&#x662F;&#x6211;&#x4EEC;&#x7684;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x77E5;&#x9053;&#x8981;&#x8C03;&#x67E5;&#x7684;&#x4EE3;&#x7801;&#x533A;&#x57DF;&#x3002;</p>
<h4 id="&#x539F;&#x6587;&#x94FE;&#x63A5;&#xFF1A;"><a href="#&#x539F;&#x6587;&#x94FE;&#x63A5;&#xFF1A;" class="headerlink" title="&#x539F;&#x6587;&#x94FE;&#x63A5;&#xFF1A;"></a><strong>&#x539F;&#x6587;&#x94FE;&#x63A5;&#xFF1A;</strong></h4><ul>
<li><a href="https://blogs.msdn.microsoft.com/ntdebugging/2013/06/14/understanding-pool-corruption-part-1-buffer-overflows/" target="_blank" rel="noopener">Understanding Pool Corruption Part 1 &#x2013; Buffer Overflows</a></li>
<li><a href="https://blogs.msdn.microsoft.com/ntdebugging/2013/08/22/understanding-pool-corruption-part-2-special-pool-for-buffer-overruns/" target="_blank" rel="noopener">Understanding Pool Corruption Part 2 &#x2013; Special Pool for Buffer Overruns</a></li>
<li><a href="https://blogs.msdn.microsoft.com/ntdebugging/2013/12/31/understanding-pool-corruption-part-3-special-pool-for-double-frees/" target="_blank" rel="noopener">Understanding Pool Corruption Part 3 &#x2013; Special Pool for Double Frees</a></li>
</ul>
<p>&#x5171;&#x52C9;&#x3002;</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
      <div>
      
        
<div class="my_post_copyright">
  <script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>
  
  <!-- JS库 sweetalert 可修改路径 -->
  <script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <p><span>本文标题:</span><a href="/2019/07/23/20190723-3/">[翻译]内核池基础知识（池损坏）</a></p>
  <p><span>文章作者:</span><a href="/" title="访问 Saturn35 的个人博客">Saturn35</a></p>
  <p><span>发布时间:</span>2019年07月23日 - 16:23</p>
  <p><span>最后更新:</span>2019年12月28日 - 13:22</p>
  <p><span>原始链接:</span><a href="/2019/07/23/20190723-3/" title="[翻译]内核池基础知识（池损坏）">https://saturn35.github.io/2019/07/23/20190723-3/</a>
    <span class="copy-path" title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="https://saturn35.github.io/2019/07/23/20190723-3/" aria-label="复制成功！"></i></span>
  </p>
  <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p>  
</div>
<script> 
    var clipboard = new Clipboard('.fa-clipboard');
    $(".fa-clipboard").click(function(){
      clipboard.on('success', function(){
        swal({   
          title: "",   
          text: '复制成功',
          icon: "success", 
          showConfirmButton: true
          });
    });
    });  
</script>

      
      </div>
      
      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/07/23/20190723-2/" rel="next" title="[02] HEVD 内核漏洞之栈溢出">
                <i class="fa fa-chevron-left"></i> [02] HEVD 内核漏洞之栈溢出
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/07/24/20190724-1/" rel="prev" title="[03] HEVD 内核漏洞之UAF">
                [03] HEVD 内核漏洞之UAF <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  




        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/head.jpg" alt="Saturn35">
            
              <p class="site-author-name" itemprop="name">Saturn35</p>
              <p class="site-description motion-element" itemprop="description">心诚求之，虽不中，不远矣。</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">25</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Saturn35" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:zyty718@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://twitter.com/sat0rnzy" target="_blank" title="Twitter">
                      
                        <i class="fa fa-fw fa-twitter"></i>Twitter</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://bbs.pediy.com/user-home-831334.htm" target="_blank" title="kanxue">
                      
                        <i class="fa fa-fw fa-book"></i>kanxue</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#Part1-Buffer-Overflows"><span class="nav-number">1.</span> <span class="nav-text">Part1  Buffer Overflows</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Part2-Special-Pool-for-Buffer-Overruns"><span class="nav-number">2.</span> <span class="nav-text">Part2  Special Pool for Buffer Overruns</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Part3-Special-Pool-for-Double-Frees"><span class="nav-number">3.</span> <span class="nav-text">Part3 Special Pool for Double Frees</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#原文链接："><span class="nav-number">4.</span> <span class="nav-text">原文链接：</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Saturn35</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">101.9k</span>
  
</div>











        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: true,
        appId: '1fB9JY8xOQdkT8o7B5JMLEK4-MdYXbMMI',
        appKey: 'I5Me1NOQdPHTJgK0ELfVmocG',
        placeholder: 'Comment here...',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  





  

  

  

  
  

  

  

  


<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>

<script type="text/javascript" src="/js/src/click_show_text.js"></script>

<script type="text/javascript" src="/js/src/FunnyTitle.js"></script>